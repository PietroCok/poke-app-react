import{j as e,u as D,d as ee,r as m,K as $,L as q,N as Q,c as se,M as K,s as ae,f as te,Q as re,I as ne,l as ie,S as oe,w as le,T as ce,U as de,V as f,W as ue}from"./react-DsNixYkS.js";import{P,M as F,B as g,a as O,u as H,b as X,c as B,L as z,r as me,d as U,C as pe,e as xe,O as fe,f as ge,g as he,F as je,h as M,i as ve,U as G,j as be,k as we,l as Ne,T as Ce,S as ye,m as Se,n as Ie,o as Me,p as Pe,q as J,s as Ee,D as Oe,t as ke,v as Ae,I as Re,w as Le,x as Te,y as Fe,A as He,z as ze,E as De,G as Ue,H as _e,J as V}from"./components-Bdd2YW-g.js";import{F as Y,A as T}from"./firebase-BW08cwwr.js";import{F as h}from"./fontawesome-BCH0MxRp.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const c of t.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function r(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerPolicy&&(t.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?t.credentials="include":s.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function i(s){if(s.ep)return;s.ep=!0;const t=r(s);fetch(s.href,t)}})();function qe(){return e.jsxs("div",{className:"page-container h-100",children:[e.jsx(P,{right:e.jsx(F,{})}),e.jsxs("section",{className:"flex flex-column align-center gap-2 text-large",children:[e.jsx("span",{children:"Cosa vuoi ordinare?"}),e.jsxs("div",{className:"flex flex-column align-center gap-2",children:[e.jsx(g,{text:"Poke",classes:"border-r-10 w-100 text-center border-1-solid border-primary large main-bg primary-color",linkTo:"/poke-configurator"}),e.jsx(g,{text:"Menu",classes:"border-r-10 w-100 text-center border-1-solid border-primary large main-bg primary-color",linkTo:"/menu"})]})]}),e.jsx(O,{})]})}function Be(){const n=D(),a=ee(),{login:r,setOffline:i}=H(),[s,t]=m.useState(""),[c,o]=m.useState(""),[d,l]=m.useState(""),[u,p]=m.useState(""),[y,v]=m.useState(""),[b,C]=m.useState(!1),{showAlert:S,showConfirm:k}=X(),{showError:A}=B(),R=!!(s&&c)&&!(u||d),L=a.state?.from?.pathname||"/",j=L!=="/login"?L:"/",x=I=>{const N=I.target.value;N.length>=6?l(""):l("Inserire almeno 6 caratteri"),o(N)},w=I=>{const N=I.target.value;N.indexOf("@")>0&&N.indexOf("@")!=N.length-1?p(""):p("Email non valida"),t(N)},E=async I=>{if(I.preventDefault(),!R)return;C(!0);const N=await r(s,c);if(C(!1),N instanceof Y){switch(N.code){case T.INVALID_EMAIL:p("Mail non valida");break;case T.INVALID_PASSWORD:l("Password non valida");break;case T.INVALID_LOGIN_CREDENTIALS:v("Credenziali errate"),o("");break;default:v("Impossibile accedere. Riprova più tardi.");break}return}n(j,{replace:!0})},_=async I=>{I.preventDefault(),await k("Forzando la navigazione offline alcune funzionalità non saranno disponibili, continuare?")&&(i(!0),n(j,{replace:!0}))},Z=async I=>{if(I.preventDefault(),!s.trim()||u){A("Inserire un indirizzo mail per proseguire");return}if(!await k("Procedere con il reset della password?"))return;await me(s)?A("Qualcsa è andato storto durante l'operazione, provare più tardi",{duration:10}):S(`È stata inviata una mail con la precedura di reset della password all'indirizzo ${s}`)};return e.jsx("div",{className:"page-container login",children:e.jsxs("form",{method:"POST",action:"",onSubmit:E,className:"login-form",children:[e.jsx("h1",{className:"text-center",children:"Poke App"}),e.jsxs("div",{className:"email-form-container",children:[e.jsxs("label",{htmlFor:"email",className:"form-element",title:"email",children:[e.jsx(h,{icon:$,className:"input-icon"}),e.jsx("input",{type:"email",name:"email",id:"email",placeholder:"Email",autoComplete:"username",onChange:w,required:!0})]}),u&&e.jsx("div",{className:"form-validation-message error-message email",children:u})]}),e.jsxs("div",{className:"password-form-container",children:[e.jsxs("label",{htmlFor:"password",className:"form-element",title:"password",children:[e.jsx(h,{icon:q,className:"input-icon"}),e.jsx("input",{type:"password",name:"password",id:"password",placeholder:"Password",autoComplete:"current-password",onChange:x,value:c,required:!0})]}),d&&e.jsx("div",{className:"form-validation-message error-message password",children:d})]}),y&&e.jsx("div",{className:"form-submit-message",children:y}),e.jsx("span",{className:"fake-link",onClick:Z,children:"Password dimenticata?"}),e.jsxs("div",{className:"login-form-controls",children:[e.jsx("div",{className:"login-submit-container",children:b?e.jsx(z,{radius:10,duration:1,color:"var(--primary-color)"}):e.jsx(g,{text:"accedi",type:"submit",tooltip:"Accedi",disabled:!R,disabledMessage:"Email o password non validi",classes:"primary-bg primary-contrast-color w-100"})}),e.jsxs("span",{className:"flex gap-1 just-between w-100",children:["Non hai ancora un account?",e.jsx(Q,{to:"/register",children:"Registrati"})]}),e.jsx(g,{text:"continua come ospite",type:"button",tooltip:"Forza navigazione offline",clickHandler:_,classes:"access-offline"})]})]})})}const Ge=10;function Ve(){const{cart:n,deleteAllItems:a,deleteItem:r,duplicateItem:i,getItemsCount:s}=U(),{user:t}=H(),[c,o]=m.useState(!1),d=t?.uid||"",u=s()>0,p=!n.isShared||d===n.createdBy;return e.jsxs("div",{className:"page-container h-100 flex flex-column",children:[e.jsx(P,{left:e.jsx(e.Fragment,{}),center:e.jsx(pe,{}),right:e.jsx(F,{}),classes:"main-bg"}),e.jsx(xe,{}),e.jsx("section",{className:`flex flex-column flex-1 padding-1 gap-1 scroll\r
        `,children:We(n,d,r,i)}),c&&e.jsx(fe,{hideModal:()=>o(!1)}),e.jsx(O,{left:e.jsx(g,{text:"svuota",classes:"red-bg primary-contrast-color border-r-10",clickHandler:()=>a(),disabled:!p||!u,disabledMessage:p?"Il carrello è vuoto":"Operazione consentita solo al creatore del carrello"}),right:e.jsx(g,{text:"Preview",classes:"primary-bg primary-contrast-color border-r-10",clickHandler:()=>{o(!0)},disabled:!p||!u,disabledMessage:p?"Il carrello è vuoto":"Operazione consentita solo al creatore del carrello"}),classes:"main-bg"})]})}const We=(n,a,r,i)=>{const s=n.items||{},t=Object.keys(s).length;return t==0?e.jsx("span",{className:"flex flex-center h-100",children:"Il carrello è vuoto"}):Object.values(s).sort((o,d)=>o.name>d.name?1:-1).map(o=>e.jsx(ge,{item:o,disabled:o.createdBy!=a&&n.createdBy!=a,useMemo:t>Ge,duplicate:i,deleteItem:r},o.id))},$e=10;function Qe(){const{favorites:n,removeFavorite:a,removeAllFavorites:r,duplicateItem:i}=he(),s=n.length>0;return e.jsxs("div",{className:"page-container h-100 flex flex-column",children:[e.jsx(P,{center:e.jsx("h3",{className:"flex flex-center h-100",children:"Preferiti"}),right:e.jsx(F,{}),classes:"main-bg"}),e.jsx("section",{className:"flex-1 flex flex-column padding-1 gap-1",children:s?Ke(n,n.length>$e,a,i):e.jsx("span",{className:"flex flex-center h-100",children:"Nessun preferito disponibile"})}),e.jsx(O,{left:e.jsx(g,{text:"svuota",classes:"red-bg primary-contrast-color border-r-10",clickHandler:r,disabled:!s,disabledMessage:"Nessun preferito da eliminare"}),classes:"main-bg"})]})}const Ke=(n,a,r,i)=>n.map(s=>e.jsx(je,{item:s,deleteItem:r,duplicate:i,useMemo:a},s.id));function Xe(){return e.jsx(e.Fragment,{children:e.jsx("div",{children:"This is the PersonalArea page"})})}function Je({}){const n=D(),{signUp:a}=H(),[r,i]=m.useState(""),[s,t]=m.useState(""),[c,o]=m.useState(""),[d,l]=m.useState(""),[u,p]=m.useState(""),[y,v]=m.useState(""),[b,C]=m.useState(!1),S=!!(r&&s&&c&&s==c)&&!(u||d),k=j=>{const x=j.target.value;x.length>=6?l(""):l("Inserire almeno 6 caratteri"),t(x)},A=j=>{const x=j.target.value;x!=s?l("Le password inserite non combaciano"):l(""),o(x)},R=j=>{const x=j.target.value;x.indexOf("@")>0&&x.indexOf("@")!=x.length-1?p(""):p("Email non valida"),i(x)},L=async j=>{if(j.preventDefault(),!S)return;C(!0);const x=await a(r,s);if(console.log(x),C(!1),x instanceof Y){switch(x.code){case T.INVALID_EMAIL:p("Mail non valida");break;case T.INVALID_PASSWORD:l("Password non valida");break;case T.EMAIL_EXISTS:v("Email già in uso"),t("");break;default:v("Impossible completare la registrazione. Riprova più tardi.");break}return}n("/")};return e.jsx("div",{className:"page-container signup",children:e.jsxs("form",{method:"POST",action:"",onSubmit:L,className:"signup-form",children:[e.jsx("h1",{className:"text-center",children:"Poke App"}),e.jsxs("div",{className:"email-form-container",children:[e.jsxs("label",{htmlFor:"email",className:"form-element",title:"email",children:[e.jsx(h,{icon:$,className:"input-icon"}),e.jsx("input",{type:"email",name:"email",id:"email",placeholder:"Email",autoComplete:"username",onChange:R,required:!0})]}),u&&e.jsx("div",{className:"form-validation-message email",children:u})]}),e.jsxs("div",{className:"password-form-container",children:[e.jsxs("label",{htmlFor:"password",className:"form-element",title:"password",children:[e.jsx(h,{icon:q,className:"input-icon"}),e.jsx("input",{type:"password",name:"password",id:"password",placeholder:"Password",autoComplete:"new-password",onChange:k,value:s,required:!0})]}),e.jsxs("label",{htmlFor:"password-confirm",className:"form-element password-confirm",title:"conferma password",children:[e.jsx(h,{icon:q,className:"input-icon"}),e.jsx("input",{type:"password",name:"password-confirm",id:"password-confirm",placeholder:"Conferma password",autoComplete:"new-password",onChange:A,value:c,required:!0})]}),d&&e.jsx("div",{className:"form-validation-message password",children:d})]}),y&&e.jsx("div",{className:"form-submit-message",children:y}),e.jsxs("div",{className:"signup-form-controls",children:[e.jsx("div",{className:"signup-submit-container",children:b?e.jsx(z,{radius:10,duration:1,color:"var(--primary-color)"}):e.jsx(g,{text:"Registrati",type:"submit",tooltip:"Registrati",disabled:!S,classes:"primary-bg primary-contrast-color w-100"})}),e.jsxs("span",{className:"flex gap-1 just-between w-100",children:["Hai già un account?",e.jsx(Q,{to:"/login",children:"Accedi"})]})]})]})})}function Ye(){return e.jsx("h1",{children:"404"})}function Ze(){const{user:n}=H(),[a,r]=m.useState([]),[i,s]=m.useState(!1),t=async()=>{i||(s(!0),r(await ve()),s(!1))},c=async(o,d)=>{if(await be(o,d)){const u=structuredClone(a.find(p=>p.uid===o));if(!u)return;u.status=d,r([...a.filter(p=>p.uid!=o),u])}};return m.useEffect(()=>{t()},[]),e.jsxs("div",{className:"page-container flex flex-column",children:[e.jsx(P,{classes:"main-bg",left:e.jsx(M,{icon:e.jsx(h,{icon:ae}),classes:"primary-color border-r-10",tooltip:"Indietro",linkTo:"/"}),center:e.jsx("h2",{className:"flex flex-center h-100",children:"Accounts"}),right:e.jsx(M,{icon:e.jsx(h,{color:"var(--primary-color)",icon:K}),classes:"border-r-10",tooltip:"Ricarica",clickHandler:t})}),i&&se.createPortal(e.jsx(z,{fullscreen:!0,radius:20,duration:2,color:"var(--primary-color)"}),document.getElementById("root")),!i&&e.jsx("section",{className:"flex gap-1 flex-column padding-1",children:ss(a,n,c)})]})}const es=n=>n.slice().sort((a,r)=>a.status==r.status?(a.createdAt||"")>(r.createdAt||"")?-1:1:G[a.status]-G[r.status]),ss=(n,a,r)=>es(n).map(i=>{const s=a.uid===i.uid;let t="red-bg";return i.status=="active"?t="green-bg":i.status=="pending"&&(t="gold-bg"),e.jsxs("div",{className:"users-list-element",children:[e.jsx("div",{children:i.email}),e.jsxs("div",{className:"flex align-center gap-05",children:[e.jsx("div",{className:`user-status ${t}`,title:i.status}),i.status=="active"?e.jsx(M,{icon:e.jsx(h,{color:"var(--accent-red)",icon:te}),tooltip:"Disabilita utente",classes:"small border-round",disabled:s,clickHandler:()=>r(i.uid,"disabled")}):e.jsx(M,{icon:e.jsx(h,{color:"var(--primary-color)",icon:re}),tooltip:"Abilita utente",classes:"small border-round",disabled:s,clickHandler:()=>r(i.uid,"active")})]})]},i.uid)});function as({}){const n=D(),{user:a,isUserActive:r}=H(),{cart:i,updateCart:s,unlinkCart:t,deleteCart:c,deleteCarts:o}=U(),[d,l]=m.useState([]),[u,p]=m.useState(!1),[y,v]=m.useState(!1),{showConfirm:b}=X(),{showInfo:C}=B();m.useEffect(()=>{S()},[]);const S=async()=>{if(!a||u)return;p(!0);const w=await we(a.uid);w&&l(w),console.log(w),p(!1)},k=w=>{const E=d.find(_=>_.id==w);E&&(s(E),C(`Caricato il carrello condiviso: ${E.name}`),n("/cart"))},A=async(w,E)=>{await b(`Eliminare il carrello ${E}?`)&&await c(w)&&S()},R=()=>{t()},L=async()=>{a?.uid&&await b("Eliminare/Scollegare definitivamente TUTTI i carrelli condivisi?")&&await o(d)&&S()},j=()=>{v(!0)},x=w=>ts(d,i.id,A,k,R,a?.uid??"",w);return e.jsxs("div",{className:"page-container h-100 flex flex-column",children:[e.jsx(P,{center:e.jsx("h3",{className:"h-100 flex flex-center text-center",children:"Carrelli condivisi"}),right:e.jsx(F,{}),classes:"main-bg"}),y&&e.jsx(Ne,{setIsOpen:v}),u?e.jsx(z,{radius:30,duration:2,color:"var(--primary-color)"}):e.jsx("div",{className:"flex-1 flex flex-column gap-1 padding-0-1 scroll",children:e.jsx(Ce,{tabsName:["creati da me","inviti"],tabsContent:[x("creator"),x("invited")]})}),e.jsx(O,{classes:"main-bg",left:e.jsx(M,{icon:e.jsx(h,{icon:ie}),classes:"border-r-10 red",tooltip:"Cancella tutti i carrelli considivi",clickHandler:L,disabled:d.length==0,disabledMessage:"Nessun carrello da eliminare"}),center:e.jsx(M,{icon:e.jsx(h,{icon:ne}),classes:"border-r-10 primary-color",tooltip:"Nuovo carrello condiviso",clickHandler:j,disabled:!r(),disabledMessage:"Operazione disponibile ai soli utenti abilitati"}),right:e.jsx(M,{icon:e.jsx(h,{icon:K}),classes:"border-r-10 primary-color",tooltip:"Ricarica",clickHandler:S})})]})}const ts=(n,a,r,i,s,t,c)=>{let o=n;return c==="creator"?o=n.filter(l=>l.createdBy===t):c==="invited"&&(o=n.filter(l=>l.createdBy!=t)),o.length===0?e.jsx("div",{className:"flex-1 flex flex-center",children:"Nessun carrello presente"}):o.sort((l,u)=>(l.createdAt??"")<(u.createdAt??"")?1:-1).map(l=>e.jsx(ye,{cart:l,deleteSharedCart:r,unlinkSharedCart:s,loadCartAsActive:i,activeCartId:a},l.id))};function rs({}){const[n,a]=m.useState(!1),[r,i]=m.useState(!1),{user:s}=H(),{cartId:t,cartName:c}=oe(),{updateCart:o}=U(),{showError:d}=B(),l=D(),u=s?.uid||"";if(!t||!c)return e.jsx("div",{children:"Invalid link"});m.useEffect(()=>{a(!0),(async()=>{await Se(t,u)&&i(!0),a(!1)})()},[]);const p=async()=>{if(a(!0),!await Ie(t,u)){d("Ops, qualcosa è andato storto durante la registrazione del carrello condiviso."),a(!1);return}v(t)},y=async b=>{const C=await Me(b);return C?(o(C),!0):(d("Ops, qualcosa è andato storto durante il recupero del carello condiviso"),a(!1),!1)},v=async b=>{await y(b)&&l("/cart",{replace:!0})};return e.jsxs("div",{className:"page-container h-100 flex flex-column",children:[e.jsx(P,{}),n?e.jsx(z,{radius:30,duration:2,color:"var(--primary-color)"}):e.jsx("section",{className:"flex flex-center flex-column gap-2 flex-1 scroll text-center padding-1",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Il carrello ",e.jsx("strong",{children:c})," è già registrato tra quelli disponibili"]}),e.jsx(g,{text:"vai al carrello",classes:"border-r-10 primary-bg primary-contrast-color w-fit",clickHandler:()=>v(t)})]}):e.jsxs(e.Fragment,{children:["Sei stato invitato ad unirti al carrello condiviso: ",e.jsx("strong",{children:c})]})}),e.jsx(O,{classes:"main-bg",left:e.jsx(g,{text:"rifiuta",classes:"border-r-10 red-bg primary-contrast-color",linkTo:"/",disabled:r}),right:e.jsx(g,{text:"accetta",classes:"border-r-10 primary-bg primary-contrast-color",clickHandler:p,disabled:r})})]})}function ns({menu:n}){const[a,r]=m.useState(!1),{dishes:i,addDish:s,removeDish:t,increaseQuantity:c,resetContext:o,hasDishes:d,getTotalPrice:l}=Pe(),{getItemsCount:u}=U(),p=!d();return e.jsxs("div",{className:"page-container h-100 flex flex-column",children:[e.jsx(P,{left:e.jsx(M,{icon:e.jsx(h,{icon:le}),classes:"gold border-r-10",tooltip:"Carrello",linkTo:"/cart","data-cart-count":u()||null}),right:e.jsx(F,{})}),e.jsx("h2",{id:"page-title",children:"Menu"}),e.jsx("section",{className:"menu-container flex flex-column flex-1",children:is(n,i,s,t,c)}),e.jsx(O,{left:e.jsx(g,{text:"svuota",classes:"red-bg primary-contrast-color border-r-10",clickHandler:o,disabled:p,disabledMessage:"Nessun ingrediente selezionato",tooltip:"Rimuove la selezione attuale"}),center:e.jsxs("div",{className:"flex flex-center h-100 gap-5",children:["Totale: ",e.jsx("span",{children:l().toFixed(2)})," €"]}),right:e.jsx(g,{text:"salva",classes:"primary-bg primary-contrast-color border-r-10",disabled:p,disabledMessage:"Nessun ingrediente selezionato",tooltip:"Salva la selezione attuale",clickHandler:()=>r(!0)}),classes:"main-bg"}),a&&e.jsx(J,{hideModal:()=>r(!1),source:"dish"})]})}function is(n,a,r,i,s){return Object.keys(n).map(t=>{const c=n[t].map(o=>{const d=Ee(o.name),l=a.find(u=>u.id==d);return{...o,id:d,selected:!!l,quantity:l?l.quantity:0}});return e.jsx(Oe,{category:t,dishes:c,addDish:r,removeDish:i,increaseQuantity:s},t)})}function os({sizes:n,groups:a}){const[r,i]=m.useState(!1),{resetContext:s,hasIngredients:t,getTotalPrice:c}=ke(),o=!t(),d=Object.entries(n),l=Object.entries(a);return e.jsxs("div",{className:"page-container",children:[e.jsx(P,{right:e.jsx(F,{})}),e.jsx("h2",{id:"page-title",children:"crea la tua poke bowl"}),e.jsx(Ae,{sizes:d}),e.jsx("section",{id:"ingredients-selection-container",children:ls(l)}),e.jsx(O,{left:e.jsx(g,{text:"svuota",classes:"red-bg primary-contrast-color border-r-10",clickHandler:s,disabled:o,disabledMessage:"Nessun ingrediente selezionato",tooltip:"Rimuove la selezione attuale"}),center:e.jsxs("div",{className:"flex flex-center h-100 gap-5",children:["Totale: ",e.jsx("span",{children:c().toFixed(2)})," €"]}),right:e.jsx(g,{text:"salva",classes:"primary-bg primary-contrast-color border-r-10",disabled:o,disabledMessage:"Nessun ingrediente selezionato",tooltip:"Salva la selezione attuale",clickHandler:()=>i(!0)}),classes:"main-bg"}),r&&e.jsx(J,{hideModal:()=>i(!1),source:"poke"})]})}function ls(n){return n.map(a=>{const r={id:a[0],...a[1]};return e.jsx(Re,{group:r},r.id)})}const W=ze;function cs(){return e.jsx(Le,{children:e.jsx(Te,{children:e.jsx(Fe,{children:e.jsx(He,{children:e.jsx(ce,{basename:"poke-app-react",children:e.jsxs(de,{children:[e.jsx(f,{path:"/login",element:e.jsx(Be,{})}),e.jsx(f,{path:"/register",element:e.jsx(Je,{})}),e.jsxs(f,{element:e.jsx(V,{}),children:[e.jsxs(f,{element:e.jsx(_e,{}),children:[e.jsx(f,{element:e.jsx(Ue,{}),children:e.jsxs(f,{element:e.jsx(De,{}),children:[e.jsx(f,{path:"/",element:e.jsx(qe,{})}),e.jsx(f,{path:"/poke-configurator",element:e.jsx(os,{...W})}),e.jsx(f,{path:"/menu",element:e.jsx(ns,{...W})}),e.jsx(f,{path:"/cart",element:e.jsx(Ve,{})}),e.jsx(f,{path:"/favorites",element:e.jsx(Qe,{})})]})}),e.jsx(f,{path:"/shared-carts",element:e.jsx(as,{})}),e.jsx(f,{path:"/cart/invite/:cartId/:cartName",element:e.jsx(rs,{})})]}),e.jsx(f,{path:"/personal",element:e.jsx(Xe,{})}),e.jsx(f,{path:"*",element:e.jsx(Ye,{})})]}),e.jsx(f,{element:e.jsx(V,{roles:["admin"]}),children:e.jsx(f,{path:"/admin/users",element:e.jsx(Ze,{})})})]})})})})})})}ue.createRoot(document.getElementById("root")).render(e.jsx(m.StrictMode,{children:e.jsx(cs,{})}));

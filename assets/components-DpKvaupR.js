import{j as r,R as dt,r as d,f as ee,a as ut,b as mt,N as de,c as Ee,u as Y,O as te,d as Se,e as Ie,g as pe,h as pt,i as ft,k as gt,l as ht,m as xt,n as jt,o as re,p as we,q as vt,s as bt,t as fe,v as ke,w as Ct,x as yt,y as It,z as wt,A as Te,B as Ae,C as Pe,D as Oe,E as Nt,F as Et,G as Me,H as $e,I as St,J as kt,K as Tt,L as De}from"./react-DkmqZLaq.js";import{F as x}from"./fontawesome-DHDj3g3E.js";import{i as At,g as Pt,a as G,r as N,o as Ot,b as ne,u as ae,s as ge,c as Mt,d as $t,F as se,e as Dt,f as Rt,h as zt,j as Ut,A as _t,k as Ht}from"./firebase-rLowPoAX.js";const Ft={regular:{limits:{proteine:1,condimenti:4,croccantini:2,salse:3},price:8.9},large:{limits:{proteine:2,condimenti:5,croccantini:2,salse:3},price:10.9}},Lt={proteine:{extras:"extra salmone tonno crudo € 2.00 / altri € 1.50",options:[{name:"salmone crudo",price:2},{name:"tonno crudo",price:2},{name:"salmone cotto",price:1.5},{name:"tonno sott'olio",price:1.5},{name:"gamberi cotti",price:1.5},{name:"tempura di gamberi",price:1.5},{name:"cotoletta di pollo",price:1.5},{name:"pollo cotto",price:1.5},{name:"tofu fresco",price:1.5},{name:"uova sode",price:1.5},{name:"uova al tegamino",price:1.5}],order:0},condimenti:{extras:"extra € 0.50",options:[{name:"alghe wakame",price:.5},{name:"mais",price:.5},{name:"avocado",price:.5},{name:"ceci",price:.5},{name:"pomodorino",price:.5},{name:"edamame",price:.5},{name:"peperoni",price:.5},{name:"fagioli",price:.5},{name:"cetrioli",price:.5},{name:"mango",price:.5},{name:"carote",price:.5},{name:"zenzero",price:.5},{name:"ananas",price:.5},{name:"olive nere",price:.5}],order:1},croccantini:{extras:"extra € 0.50",options:[{name:"anacardi",price:.5},{name:"mandorle",price:.5},{name:"alghe nori",price:.5},{name:"sesamo",price:.5},{name:"tobico",price:.5},{name:"kataifi",price:.5},{name:"noci",price:.5},{name:"cipolla croccante",price:.5},{name:"pistacchio",price:.5}],order:2},salse:{extras:"extra € 0.50",options:[{name:"olio di oliva",price:.5},{name:"aceto balsamico",price:.5},{name:"soia",price:.5},{name:"maionese",price:.5},{name:"philadelphia",price:.5},{name:"teriyaki",price:.5},{name:"wasabi",price:.5},{name:"spicy maionese",price:.5},{name:"salsa mango",price:.5},{name:"salsa ponzu",price:.5},{name:"salsa agrodolce",price:.5},{name:"salsa agropiccante",price:.5},{name:"salsa yogurt",price:.5}],order:3}},qt={antipasti:[{name:"involtini primavera",price:2,code:"1"},{name:"goma wakame",price:4,code:"2"},{name:"nuvolette di gamberi",price:2,code:"3"},{name:"verdura agropiccante",price:4,code:"4"},{name:"toast di gamberi",price:4,code:"4a"},{name:"antipasto assortito",price:4,code:"5"},{name:"antipasto di mare freddo",price:5,code:"5a"},{name:"frutti di mare fritti",price:6,code:"6"},{name:"vedrura mista fritto",price:4,code:"7"},{name:"cocktail di gamberi",price:6,code:"7a"},{name:"ravioli con carne al vapore",price:4,code:"8"},{name:"ravioli di verdure al vapore",price:4,code:"8a"},{name:"ravioli alla griglia",price:4,code:"9"},{name:"ciao mai (ravioli misti carne e pesce)",price:4,code:"10"},{name:"patate fritte",price:3,code:"11"},{name:"ravioli di gamberi",price:4,code:"11a"}],zuppe:[{name:"zuppa pechinese",price:4,code:"12"},{name:"zuppa mais",price:4,code:"14"},{name:"zuppa spaghetti di soia con funghi",price:4,code:"15"},{name:"zuppa di granchio e asparagi",price:4,code:"16"}],"paste e riso":[{name:"riso alla cantonese",price:4,code:"18"},{name:"riso con gamberetti",price:4.5,code:"19"},{name:"riso con gamberi carne e pollo piccante",price:4.5,code:"19a"},{name:"riso con curry",price:4,code:"20"},{name:"riso con verdure",price:4,code:"20a"},{name:"riso con frutti di mare",price:5,code:"21"},{name:"gnocchi di riso con gamberretti",price:4,code:"22"},{name:"spaghetti di riso cinesi",price:4,code:"23"},{name:"spaghetti di soia con carne piccanti",price:4,code:"24"},{name:"spaghetti di soia con verdure",price:4,code:"25"},{name:"spaghetti di soia con gamberretti",price:4.5,code:"25a"},{name:"spaghetti con gamberreti",price:4.5,code:"26"},{name:"spaghetti con verdure",price:4,code:"27"},{name:"spaghetti alla piastra con frutti di mare",price:5,code:"28"},{name:"riso bianco",price:2,code:"29a"}],pollo:[{name:"pollo con mandorle",price:5,code:"30"},{name:"pollo con verdure miste",price:5,code:"31"},{name:"pollo con bambu e funghi cinesi",price:5,code:"32"},{name:"pollo in salsa agro dolce",price:5,code:"33"},{name:"pollo piccante",price:5,code:"34"},{name:"pollo al curry",price:5,code:"35"},{name:"pollo fritto",price:5,code:"36"},{name:"pollo al lomone",price:5,code:"37"},{name:"pollo con gamberetti e funghi",price:5,code:"38"},{name:"pollo con anacardi",price:5,code:"39a"},{name:"spiedini di pollo alla griglia",price:5,code:"01"}],maiale:[{code:"50",name:"maiale piccante",price:5},{code:"51",name:"maiale con verdure miste",price:5},{code:"52",name:"maiale con fughi e bambu",price:5},{code:"53",name:"maiale in salsa agro dolce",price:5},{code:"54",name:"puntine di maiale alla griglia",price:5},{code:"56",name:"maiale alla piastra",price:5}],manzo:[{code:"60",name:"manzo con cipolle",price:6},{code:"61",name:"manzo con verdure miste",price:6},{code:"62",name:"manzo con bambu e funghi",price:6},{code:"63",name:"manzo piccante",price:6},{code:"64",name:"manzo con peperoni",price:6},{code:"66",name:"manzo alla piastra",price:6}],gamberetti:[{code:"70",name:"gamberetti fritti",price:6},{code:"71",name:"gamberetti con verdure miste",price:6},{code:"72",name:"gamberetti bambu e funghi",price:6},{code:"73",name:"gamberetti agro dolce",price:6},{code:"74",name:"gamberetti alla griglia",price:6},{code:"75",name:"gamberetti sei colori",price:6},{code:"76",name:"gamberetti con limone",price:6},{code:"77",name:"gamberetti alla piastra",price:7},{code:"78",name:"gamberetti al curry",price:6},{code:"79",name:"gamberetti piccanti",price:6},{code:"03",name:"spiedini di gamberi alla griglia",price:6}],calamari:[{code:"84",name:"calamari fritti",price:6},{code:"85",name:"calamari con pepperoni",price:6},{code:"86",name:"calamari piccante",price:6},{code:"87",name:"calamari alla piastra",price:6},{code:"87a",name:"calamari bambu e funghi",price:6},{code:"93",name:"frutti di mare alla piastra",price:8}],gamberoni:[{code:"95",name:"gamberoni piccante",price:8},{code:"96",name:"gamberoni stufati",price:8},{code:"97",name:"gamberoni alla griglia",price:8},{code:"98",name:"gamberoni alla piastra",price:8}],omelette:[{code:"100",name:"omelette con gamberi",price:4},{code:"101",name:"omelette con granchio",price:4},{code:"102",name:"omelette con pollo",price:4}],contorni:[{code:"103",name:"insalata con gamberi",price:4},{code:"104",name:"insalata con granchio",price:4},{code:"105",name:"verdure mista alla piastra",price:4.5},{code:"106",name:"bambu con funghi",price:4},{code:"106a",name:"funghi saltato",price:4.5},{code:"107",name:"verdure mista saltati",price:4}],dessert:[{code:"201",name:"Gelato fritto",price:4},{code:"202",name:"Latte fritto",price:4},{code:"203",name:"Nutella fritto",price:4},{code:"204",name:"Frutta mista fritti",price:4},{code:"205",name:"Gelato tartufo nero e bianco",price:4},{code:"206",name:"Macedonia mista",price:4},{code:"207",name:"Ananas fresco",price:4}]},K={sizes:Ft,groups:Lt,menu:qt},Re={apiKey:"AIzaSyDC66RIeGXQJC9L9MnRmg_cIdooP5ZnZxY",authDomain:"poke-app-z.firebaseapp.com",databaseURL:"https://poke-app-z-default-rtdb.europe-west1.firebasedatabase.app",projectId:"poke-app-z",storageBucket:"poke-app-z.firebasestorage.app",messagingSenderId:"15485086714",appId:"1:15485086714:web:68cceeb9590ecfe7b69243"};console.log("Firebase configuration",Re);const ze=At(Re),E=Pt(ze);console.log("Firebase Database Initialized!");const Gt=async e=>{if(!e.email||!e.uid)return console.warn("Unable to create user record: missing email or uid!"),null;const t={email:e.email,status:"pending",createdAt:new Date().toISOString()};try{await ge(N(E,`/users/${e.uid}`),t)}catch(a){return console.warn(a),null}return console.log("User record created on db"),{...t,role:"basic",uid:e.uid}},Bt=async e=>{try{const t=await Yt(e)||[];for(const n of t)n.createdBy===e?await Ue(n.id):await he(n.id,e);return await ne(N(E,`/users/${e}`)),!0}catch(t){console.warn(t)}return!1},Vt=async e=>{try{const t=await G(N(E,`/users/${e.uid}`));if(t.exists()){const{email:n,role:a,status:s,createdAt:o}=t.val();return{email:n,role:a,status:s,createdAt:o,uid:e.uid}}else return await Gt(e)}catch(t){return console.warn(t),null}},un=async()=>{try{const e=await G(N(E,"/users"));if(e.exists()){const t=e.val(),n=[];for(const[a,s]of Object.entries(t))n.push({...s,uid:a});return n}else return[]}catch(e){return console.warn(e),[]}},mn=async(e,t)=>{if(!e||!t)return console.warn("updateUserStatus: One or more invalid parameters"),!1;try{return await ae(N(E,`/users/${e}`),{status:t}),!0}catch(n){return console.warn(n),!1}},Qt=async e=>{const t={};t[`/shared-carts/cart-${e.id}`]=e,t[`/users/${e.createdBy}/carts/cart-${e.id}/`]=!0;try{return await ae(N(E),t),!0}catch(n){console.warn(n)}return!1},pn=async e=>{try{const t=await G(N(E,`/shared-carts/cart-${e}/`));if(t.exists())return t.val()}catch(t){console.warn(t)}return null},Yt=async e=>{let t={};try{const a=await G(N(E,`users/${e}/carts/`));a.exists()&&(t=a.val())}catch{return null}const n=[];for(const a in t)try{const s=await G(N(E,`shared-carts/${a}/`));s.exists()?n.push(s.val()):he(a,e)}catch(s){console.warn(s)}return n},fn=async(e,t)=>{try{return await ae(N(E,`/users/${t}/carts/`),{[`cart-${e}`]:!0}),!0}catch(n){console.warn(n)}return!1},he=async(e,t)=>{const n=e.startsWith("cart-")?e:`cart-${e}`;try{return await ne(N(E,`/users/${t}/carts/${n}`)),console.log("Removed cart access",e),!0}catch(a){console.warn(a)}return!1},gn=async(e,t)=>{try{const n=await G(N(E,`users/${t}/carts/cart-${e}`));if(n.exists())return!!n.val()}catch(n){console.warn(n)}return!1},Kt=async(e,t)=>{try{return await ge(N(E,`/shared-carts/cart-${e}/items/${t.id}`),t),!0}catch(n){console.warn(n)}return!1},Jt=async(e,t,n)=>{try{const a={};return a[`shared-carts/cart-${e}/items/${t.id}`]=t,a[`shared-carts/cart-${e}/items/${n}`]=null,await ae(N(E),a),!0}catch(a){console.warn(a)}return!1},Wt=async e=>{try{return await ge(N(E,`/shared-carts/cart-${e}/items`),{}),!0}catch(t){return console.warn(t),!1}},Xt=async(e,t)=>{try{return await ne(N(E,`/shared-carts/cart-${e}/items/${t}`)),!0}catch(n){console.warn(n)}return!1},Ue=async e=>{try{return await ne(N(E,`/shared-carts/cart-${e}`)),!0}catch(t){console.warn(t)}return!1},Zt=(e,t)=>Ot(N(E,`/shared-carts/cart-${e}`),a=>{if(!a.exists()){t(null);return}const s=a.val();if(!s){t(null);return}t(s)},a=>console.warn(a)),U=Mt(ze);console.log("Firebase Auth Initialized!");const er=async(e,t)=>{try{const n=await Rt(U,e,t);return console.log(n),n}catch(n){if(console.log(n),n instanceof se)return n}return null},tr=async(e,t)=>{try{const n=await Dt(U,e,t);return console.log(n),n}catch(n){if(console.log(n),n instanceof se)return n}return null},hn=async e=>{try{return await zt(U,e),null}catch(t){return console.warn(t),{error:t}}},rr=async()=>{if(!U.currentUser)return"User not logged";const e=U.currentUser.uid;try{await Bt(e),await $t(U.currentUser)}catch(t){if(console.warn(t),t instanceof se)return t}return null};function nr({radius:e,duration:t=3,color:n,fullscreen:a=!1}){e<0&&(e=15),t<0&&(t=2);const s=e/5+"px";let o="",l="";o=e+"px",l=t+"s";const p=a?"fullscreen ":"";return r.jsx("div",{className:`${p}loading-container`,style:{"--radius":o,"--sub-elem-radius":s,"--loop-duration":l,"--color":n},children:r.jsxs("div",{className:"loading-spinner",children:[r.jsx("div",{}),r.jsx("div",{}),r.jsx("div",{}),r.jsx("div",{}),r.jsx("div",{})]})})}const ce=1,ar=.2,sr=dt.memo(or,(e,t)=>e?.toast.id===t?.toast.id);function or({toast:e,showNext:t}){const n=d.useRef(null);return d.useEffect(()=>{const a=setTimeout(()=>{n.current?.classList.add("animate-out")},(e.duration+ce/2)*1e3),s=setTimeout(()=>{t()},(e.duration+ce+ar)*1e3);return()=>{clearTimeout(a),clearTimeout(s)}},[]),r.jsxs("div",{ref:n,className:`toast-container flex border-r-10 gap-05 ${e.doAnimate?"animate-in":"no-animation"}`,style:{"--toast-duration":`${e.duration+ce/2}s`,"--toast-color":`${e.color}`},children:[e.icon&&r.jsx("div",{className:"icon",children:e.icon}),r.jsx("div",{className:"toast-message flex align-center",children:e.message}),r.jsx("div",{className:"pointer icon",onClick:t,children:r.jsx(x,{icon:ee})})]})}const _e=d.createContext(null),D=()=>{const e=d.useContext(_e);if(!e)throw new Error("useToast must be used within an ToastProvider");return e},ir="var(--primary-color)",cr=2,lr=2,dr=1,ur=1;function xn({children:e}){const[t,n]=d.useState({current:null,queue:[]}),{current:a}=t,s=c=>{n(i=>{const{current:f,queue:g}=i;return g.length==0&&!f?{current:c,queue:[]}:g.find(j=>j.message===c.message)||f?.message==c.message?i:(console.log("Toast added to the queue",c),{current:f,queue:[...g,c]})})},o=d.useCallback(()=>{n(c=>{const{queue:i}=c,[f,...g]=i;return{current:f??null,queue:g}})},[]),l=d.useCallback((c,i)=>{u(c,{duration:lr,color:"var(--accent-red)",icon:r.jsx(x,{icon:ut,className:"red circle"}),...i})},[]),p=d.useCallback((c,i)=>{u(c,{duration:dr,color:"var(--primary-color)",icon:r.jsx(x,{icon:mt,className:"primary-color circle"}),...i})},[]),u=d.useCallback((c,{color:i=ir,duration:f=cr,icon:g=null,doAnimate:h=!0}={})=>{const j={id:crypto.randomUUID(),message:c,color:i,duration:Math.max(f,ur),icon:g,doAnimate:h};s(j)},[]),m=d.useMemo(()=>({showToast:u,showInfo:p,showError:l}),[]);return r.jsxs(_e,{value:m,children:[e,a&&r.jsx(sr,{toast:a,showNext:o},a.id)]})}function xe({children:e,style:t,classes:n,tooltip:a,disabled:s,disabledMessage:o,type:l,linkTo:p,clickHandler:u,...m}){const{showError:c}=D();let i=n?`${n} `:"";s&&(i+="disabled ");const f=g=>{if(s){c(o||"Operazione non consentita");return}return u?u(g):""};return p?r.jsx(de,{to:p,className:`${i}button`,title:a,style:t,onClick:f,...m,children:e}):r.jsx("button",{onClick:f,className:`${i}button`,title:a,style:t,type:l,...m,children:e})}function V({text:e,classes:t,...n}){let a=t?`${t} `:"";return r.jsx(xe,{classes:`${a}button button-text`,...n,children:e})}function oe({hideModal:e,onCancel:t,title:n,titleClasses:a,content:s,contentClasses:o,actions:l,actionsClasses:p,autoFocus:u}){const m=d.useRef(null),c=i=>{i.target.id==="save-modal-backdrop"&&(t&&t(),e&&e())};return d.useEffect(()=>{if(!u)return;const i=m.current;if(i){const f=i.querySelector("button, input, select, textarea, [tabindex]:not([tabindex='-1'])");f&&f.focus()}},[u]),Ee.createPortal(r.jsx("div",{id:"save-modal-backdrop",className:"modal-backdrop",onClick:c,children:r.jsxs("div",{className:"modal-container",children:[n&&r.jsx("h3",{className:`modal-title selectable ${a??""}`,children:n}),r.jsx("div",{ref:m,className:`modal-content selectable ${o??""}`,children:s}),r.jsx("div",{className:`modal-controls flex gap-1 row-reverse ${p??""}`,children:l})]})}),document.body)}const He=d.createContext(null),B=()=>{const e=d.useContext(He);if(!e)throw new Error("useModal must be used within an ModalProvider");return e};function jn({children:e}){const[t,n]=d.useState(null),a=d.useCallback(({type:u,title:m,content:c,actions:i,onCancel:f})=>{n({type:u,title:m,content:c,actions:i,onCancel:f})},[]),s=d.useCallback(()=>{n(null)},[]),o=d.useCallback((u,m)=>a({type:"alert",title:m??"",content:u,actions:[r.jsx(V,{text:"ok",classes:"primary-bg primary-contrast-color border-r-10 medium",clickHandler:s},"ok")]}),[a,s]),l=d.useCallback(async(u,m)=>await new Promise((c,i)=>{a({type:"confirm",title:m??"",content:u,onCancel:()=>c(!1),actions:[r.jsx(V,{text:"ok",classes:"primary-bg primary-contrast-color border-r-10 medium",clickHandler:()=>{s(),c(!0)}},"ok"),r.jsx(V,{text:"annulla",classes:"red main-bg border-r-10 medium",clickHandler:()=>{s(),c(!1)}},"cancel")]})}),[a,s]),p=d.useMemo(()=>({showModal:a,showAlert:o,showConfirm:l,hideModal:s}),[a,o,l,s]);return r.jsxs(He.Provider,{value:p,children:[e,t&&r.jsx(oe,{hideModal:s,title:t.title,content:t.content,actions:t?.actions||[],onCancel:t?.onCancel})]})}const mr=Object.freeze({ADMIN:"admin"}),Fe=d.createContext(null),Le=d.createContext(null),J=()=>{const e=d.useContext(Fe);if(!e)throw new Error("useAuth must be used within an AuthProvider");const t=d.useContext(Le);if(!t)throw new Error("useAuth must be used within an AuthProvider");return{...t,...e}};function vn({children:e}){const[t,n]=d.useState(!0),[a,s]=d.useState(null),[o,l]=d.useState(null),[p,u]=d.useState(!1),{showAlert:m}=B();d.useEffect(()=>{const v=Ut(U,async I=>{console.log("onAuthStateChanged",I),I?(s(I),u(!1),l(await Vt(I))):(s(null),l(null)),n(!1)});return()=>v()},[]),console.log("User profile",o);const c=async(v,I)=>await er(v,I),i=async(v,I)=>await tr(v,I),f=async v=>{a&&await g(),u(v)},g=async()=>{Ht(U)},h=async()=>{const v=await rr();if(v instanceof se&&v.code===_t.CREDENTIAL_TOO_OLD_LOGIN_AGAIN)return m("Questa operazione richiede una autenticazione recente, eseguire nuovamente la login e riprovare"),{redirect:"/login"};if(typeof v=="string"){m(v);return}},j=d.useMemo(()=>({isUserActive:()=>pr(a,o)}),[a,o]);return t?r.jsx(nr,{color:"var(--primary-color)",duration:2,radius:40}):r.jsx(Le.Provider,{value:j,children:r.jsx(Fe.Provider,{value:{user:a,profile:o,isOffline:p,login:c,logout:g,signUp:i,setOffline:f,deleteAccount:h},children:e})})}const pr=(e,t)=>e&&t&&t.status==="active"||!1,bn={disabled:0,pending:1,active:3},$={PAYPAL:"P",CASH:"C"};function z(e,t){const[n,a]=d.useState(()=>Ge(e,t));return d.useEffect(()=>{localStorage.setItem(e,JSON.stringify(n))},[e,n]),[n,a]}function qe(e,t,n){const[a,s]=d.useReducer(t,n,()=>Ge(e,n));return d.useEffect(()=>{localStorage.setItem(e,JSON.stringify(a))},[e,a]),[a,s]}function Ge(e,t){const n=localStorage.getItem(e);try{return n!=null?JSON.parse(n):t}catch{return t}}const X=Object.fromEntries(Object.entries(K.groups).map(e=>[e[0],[]])),T={ADD_INGREDIENT:"add_ingredient",REMOVE_INGREDIENT:"remove_ingredient",INCREMENT_QUANTITY:"increment_quantity",SET_INGREDIENTS:"set_ingredients",RESET:"reset"};function fr(e,t){switch(t.type){case T.ADD_INGREDIENT:{const{groupId:n,ingredient:a}=t;return!n||!a?(console.error(`One or more parameter is missing for action: ${T.ADD_INGREDIENT} on SelectionReducer`),e):{...e,[n]:[...e[n],a]}}case T.REMOVE_INGREDIENT:{const{groupId:n,ingredientId:a}=t;return!n||!a?(console.error(`One or more parameter is missing for action: ${T.REMOVE_INGREDIENT} on SelectionReducer`),e):{...e,[n]:e[n].filter(o=>o.id!=a)}}case T.INCREMENT_QUANTITY:{const{groupId:n,ingredientId:a}=t;return!n||!a?(console.error(`One or more parameter is missing for action: ${T.INCREMENT_QUANTITY} on SelectionReducer`),e):{...e,[n]:e[n].map(o=>o.id==a?{...o,quantity:o.quantity+1}:o)}}case T.SET_INGREDIENTS:{const{ingredients:n}=t;return n?{...X,...n}:(console.error(`One or more parameter is missing for action: ${T.SET_INGREDIENTS} on SelectionReducer`),e)}case T.RESET:return X;default:return e}}const Q=K;function ie(e){return e?e.replaceAll(" ","-").replaceAll("'","--"):""}function gr(e){return e?e.replaceAll("--","'").replaceAll("-"," "):""}function hr(e,t){const n=Object.keys(e),a=Object.keys(t);if(n.length!==a.length)return!1;for(const s of n)if(e[s]!==t[s])return!1;return!0}function _(e){return"size"in e}function H(e){return"dishes"in e}function ue(e,t=!1){return _(e)?xr(e):H(e)?jr(e.dishes,t):"Unknown item type..."}function xr(e){let t="";try{t=`${e.size.toUpperCase()}: `;const n=e.ingredients,a=Object.keys(n);a.sort((s,o)=>{const l=Q.groups[s].order,p=Q.groups[o].order;return l-p});for(const s of a)for(const o of n[s])t+=o.id.replaceAll("-"," ").replaceAll("--","'")+(o.quantity>1?" x"+o.quantity:"")+", ";t=t.slice(0,t.length-2)}catch{t="Error loading item description..."}return t}function jr(e,t){let n=[];try{for(const a of e)n.push([Z[a.id].code,`${t?`${Z[a.id].code}`:""} - ${gr(a.id)} x${a.quantity}`])}catch(a){console.warn(`Error loading item description: ${a}`)}return n.sort((a,s)=>{const o=a[0],l=s[0];if(Number(o)&&Number(l))return o.padStart(6,"0").localeCompare(l.padStart(6,"0"));const p=o.match(/(\d+)(\w*)/),u=l.match(/(\d+)(\w*)/),m=p?[p[1],p[2]]:[],c=u?[u[1],u[2]]:[],i=m[0].padStart(6,"0").localeCompare(c[0].padStart(6,"0"));return i!==0?i:m[1].padStart(6,"0").localeCompare(c[1].padStart(6,"0"))}),n.map(a=>a[1]).join(`
`)}const Be=(e,t)=>!!e.find(n=>n.id===t),Z={};for(const e of Object.values(K.menu))for(const t of e)Z[ie(t.name)]={price:t.price,code:t.code};const vr=e=>Z[e]?.price??0,je=e=>e.reduce((t,n)=>t+vr(n.id)*n.quantity,0),Ve={};for(const e of Object.values(K.groups))for(const t of e.options)Ve[ie(t.name)]=t.price;const q=e=>Ve[e]??0,ve=(e,t)=>{let a=Q.sizes[e].price;for(const s of Object.keys(t))a+=Qe(e,s,t);return a},Qe=(e,t,n)=>{const a=Q.sizes[e]?.limits[t];if(Ye(t,n)<=a)return 0;const s=n[t].slice().sort((u,m)=>q(m.id)-q(u.id));let o=0,l=0,p=0;for(let u=0;u<s.length;u++){const m=s[u];let c=0;for(;o<a&&m.quantity>c;)l+=q(m.id),o++,c++;p+=q(m.id)*m.quantity}return p-=l,p},Ye=(e,t)=>{const n=t[e];let a=0;for(const s of n)a+=s.quantity;return a},br=(e,t)=>Q.sizes[e]?.limits[t]??0,Cr=e=>{const t=e.ingredients??{};return t.proteina&&(t.proteine=structuredClone(t.proteina),delete t.proteina),{id:crypto.randomUUID(),name:e.name??"poke",ingredients:{...X,...t},createdBy:"",size:e.dimension??"regular",paymentMethod:e.paymentMethod??$.CASH}},yr=()=>{console.log("Importing old poke from favorites...");try{const e=localStorage.getItem("starred");if(!e){console.log("No item to import"),localStorage.removeItem("starred");return}const t=JSON.parse(e),n=[];for(const a of t){const s=Cr(a);s&&n.push(s)}if(n.length>0){const a=localStorage.getItem("poke-favorites")??"[]",s=[...JSON.parse(a),...n];localStorage.setItem("poke-favorites",JSON.stringify(s))}}catch(e){console.warn(e)}localStorage.removeItem("starred"),console.log("Import of old poke from favorites completed")};yr();const Ke=d.createContext(null),Je=d.createContext(null),be=()=>{const e=d.useContext(Ke);if(!e)throw new Error("useMenuSelection must be used within a MenuSelectionProvider");const t=d.useContext(Je);if(!t)throw new Error("useMenuSelection must be used within a MenuSelectionProvider");return{...e,...t}};function Ir({children:e}){const[t,n]=z("menu-selection",[]),{setName:a,setPaymentMethod:s}=Ce(),[o,l]=d.useState(""),{showInfo:p}=D(),u=Y(),m=j=>{n(v=>[...v,{id:j,quantity:1}])},c=j=>{n(v=>v.filter(I=>I.id!=j))},i=j=>{n(v=>v.map(I=>({id:I.id,quantity:I.id===j?I.quantity+1:I.quantity})))},f=()=>{l(""),n([])},g=(j,v=!1)=>{n(j.dishes),a(j.name),s(j.paymentMethod||$.CASH),l(j.id),p(`${j.name} caricato`,{duration:2}),v&&u("/menu")},h=d.useMemo(()=>({getTotalPrice:()=>je(t),hasDishes:()=>t.length}),[t]);return r.jsx(Je.Provider,{value:h,children:r.jsx(Ke.Provider,{value:{dishes:t,editingId:o,addDish:m,removeDish:c,increaseQuantity:i,resetContext:f,loadDishesIntoMenu:g,setEditingId:l},children:e})})}const wr="poke-ingredients",Nr="poke-size",Er=K,Sr=Object.keys(Er.sizes)[0],We=d.createContext(null),Xe=d.createContext(null),W=()=>{const e=d.useContext(We);if(!e)throw new Error("usePokeSelection must be used within a PokeSelectionProvider");const t=d.useContext(Xe);if(!t)throw new Error("usePokeSelection must be used within a PokeSelectionProvider");return{...e,...t}};function kr({children:e}){const[t,n]=z(Nr,Sr),[a,s]=qe(wr,fr,X),{setName:o,setPaymentMethod:l}=Ce(),[p,u]=d.useState(""),{showInfo:m}=D(),c=Y(),i=(y,O)=>{s({type:T.ADD_INGREDIENT,groupId:y,ingredient:{id:O,quantity:1}})},f=(y,O)=>{s({type:T.REMOVE_INGREDIENT,groupId:y,ingredientId:O})},g=(y,O)=>{s({type:T.INCREMENT_QUANTITY,groupId:y,ingredientId:O})},h=y=>{t!=y&&n(y)},j=()=>{u(""),s({type:T.RESET})},v=(y,O=!1)=>{const L=structuredClone(y.ingredients)||{};s({type:T.SET_INGREDIENTS,ingredients:L}),n(y.size),o(y.name),l(y.paymentMethod||$.CASH),u(y.id),m(`${y.name} caricato`,{duration:2}),O&&c("/poke-configurator")},I=d.useMemo(()=>({hasIngredients:()=>Tr(a),getLimit:y=>br(t,y),groupCount:y=>Ye(y,a),groupExtraPrice:y=>Qe(t,y,a),getTotalPrice:()=>ve(t,a)}),[t,a]);return r.jsx(Xe.Provider,{value:I,children:r.jsx(We.Provider,{value:{size:t,ingredients:a,editingId:p,selectSize:h,addIngredient:i,removeIngredient:f,increaseQuantity:g,resetContext:j,loadItemIntoConfigurator:v,setEditingId:u},children:e})})}const Tr=e=>{for(const[t,n]of Object.entries(e))if(n.length>0)return!0;return!1},Ze=d.createContext(null),Ce=()=>{const e=d.useContext(Ze);if(!e)throw new Error("useSelection must be used within a SelectionProvider");return e};function Cn(){const[e,t]=z("poke-payment-method",$.CASH),[n,a]=z("poke-save-name","");return r.jsx(Ze.Provider,{value:{name:n,paymentMethod:e,setName:a,setPaymentMethod:t},children:r.jsx(Ir,{children:r.jsx(kr,{children:r.jsx(te,{})})})})}function yn({roles:e}){const{user:t,isOffline:n,profile:a}=J(),s=Se(),{showError:o}=D(),l=!n&&t&&e&&(!a||!Ar(a,e));return d.useEffect(()=>{l&&o("Utente non autorizzato")},[l,o]),!t&&!n?(console.log("User not logged. Redirecting to login page..."),r.jsx(Ie,{to:"/login",state:{from:s},replace:!0})):l?(console.log("User unauthorized. Redirecting to home page..."),r.jsx(Ie,{to:"/",replace:!0})):r.jsx(te,{})}const Ar=(e,t)=>{if(t.length==0)return!0;if(!e||!e.role)return!1;for(const n of t)if(e.role.indexOf(n)>=0)return!0;return!1};function w({icon:e,classes:t,...n}){const a=t?`${t} `:"";return r.jsx(xe,{classes:`${a} button-icon-only ${a.indexOf("-bg")>0?"":"alt-bg"}`,...n,children:e})}function et({outer:e,inner:t}){return r.jsxs("div",{className:"stacked-icons-container",children:[r.jsx("div",{className:"stacked-icons-outer",children:e}),r.jsx("div",{className:"stacked-icons-inner",children:t})]})}function Pr({icon:e,text:t,classes:n,...a}){const s=n?`${n} `:"";return r.jsxs(xe,{classes:`${s} button-text button-icon-only ${s.indexOf("-bg")>0?"":"alt-bg"}`,...a,children:[e,r.jsx("span",{className:"main-color text-normal",children:t})]})}function A({classes:e,...t}){const n=e?`${e} `:"";return r.jsx(Pr,{...t,classes:`menu-element text-capitalize flex align-center gap-1 main-bg ${n}`})}const k={UPDATE_CART:"update_cart",UNLINK:"unlink",ADD_ITEM:"add_item",REMOVE_ITEM:"remove_item",REMOVE_ALL_ITEMS:"remove_all_items",RESET:"reset"};function Or(e,t){switch(t.type){case k.UPDATE_CART:{const{cart:n}=t;return n||(console.error(`One or more parameter is missing for action: ${k.UPDATE_CART} on CartReducer`),e)}case k.ADD_ITEM:{const{item:n}=t;return n?{...e,items:{...e.items,[n.id]:n}}:(console.error(`One or more parameter is missing for action: ${k.ADD_ITEM} on CartReducer`),e)}case k.REMOVE_ITEM:{const{itemId:n}=t;if(!n)return console.error(`One or more parameter is missing for action: ${k.REMOVE_ITEM} on CartReducer`),e;const a={...e.items};return delete a[n],{...e,items:a}}case k.REMOVE_ALL_ITEMS:return{...e,items:{}};case k.UNLINK:case k.RESET:return me();default:return e}}const tt=d.createContext(null),rt=d.createContext(null),F=()=>{const e=d.useContext(tt);if(!e)throw new Error("useCart must be used within an CartProvider");const t=d.useContext(rt);if(!t)throw new Error("useCart must be used within an CartProvider");return{...e,...t}},me=(e,t,n)=>({id:crypto.randomUUID(),createdAt:new Date().toISOString(),name:t??"Carrello",createdBy:e??"",items:{},isShared:n||!1});function In({}){const{user:e,isUserActive:t}=J(),n=e?.uid||"",a=n?`poke-cart-${n}`:"poke-cart",[s,o]=qe(a,Or,me(n)),{showConfirm:l}=B(),{showError:p,showInfo:u}=D();d.useEffect(()=>{if(!e||!s.isShared)return;const b=Zt(s.id,m);return()=>b()},[e,s.id]);const m=b=>{console.log("Cart update",b),b?(b.items||(b.items={}),c(b)):o({type:k.RESET})},c=b=>{o({type:k.UPDATE_CART,cart:b})},i=b=>{b&&p("coming soon!")},f=async(b,S)=>{if(!t())return!1;let C;S?(C=structuredClone(s),C.id=crypto.randomUUID(),C.createdBy=n,C.name=b,C.isShared=!0):C=me(n,b,!0);const P=await Qt(C);return P&&c(C),P},g=async b=>t()?(j(),b.createdBy!=n?await he(b.id,n):await Ue(b.id)):!1,h=async b=>{if(!n)return!0;j();let S=!1;for(const C of b)S=await g(C)||S;return S},j=async()=>{s.isShared&&o({type:k.UNLINK})},v=async(b,S=!1)=>{const C=structuredClone(b);S&&(C.id=crypto.randomUUID()),C.createdBy=n,e&&s.isShared?S?await Jt(s.id,C,b.id)&&u("Elemento aggiornato nel carrello"):await Kt(s.id,C)&&u("Elemento salvato nel carrello"):(o({type:k.ADD_ITEM,item:C}),S?(o({type:k.REMOVE_ITEM,itemId:b.id}),u("Elemento aggiornato nel carrello")):u("Elemento salvato nel carrello"))},I=b=>{const S=s.items[b];if(!S)return;const C=structuredClone(S);C.id=crypto.randomUUID(),v(C)},y=async(b,S)=>{await l(`Confermare la cancellazione dell'elemento: ${S}?`)&&(e&&s.isShared?Xt(s.id,b):o({type:k.REMOVE_ITEM,itemId:b}))},O=async()=>{if(Object.values(s.items||{}).length!=0&&await l("Confermare la cancellazione di tutti gli elementi del carrello?"))if(e&&s.isShared){if(!s?.id)return;Wt(s.id)}else o({type:k.REMOVE_ALL_ITEMS})},L=d.useMemo(()=>({getItemsCount:()=>nt(s),getTotalPrice:b=>Mr(s,b),hasItem:b=>Be(Object.values(s.items||[]),b)}),[s.items]);return r.jsx(rt.Provider,{value:L,children:r.jsx(tt.Provider,{value:{cart:s,updateCart:c,createCart:f,deleteCart:g,deleteCarts:h,unlinkCart:j,updateCartName:i,addItem:v,duplicateItem:I,deleteItem:y,deleteAllItems:O},children:r.jsx(te,{})})})}const nt=e=>Object.keys(e.items||{}).length,Mr=(e,t)=>{if(nt(e)<=0)return 0;let n=0;for(const a of Object.values(e.items))(!t||a.paymentMethod==t)&&(_(a)?n+=ve(a.size,a.ingredients):H(a)&&(n+=je(a.dishes)));return n};function $r({classes:e,left:t,center:n,right:a}){try{const{getItemsCount:o}=F();t||(t=r.jsx(w,{icon:r.jsx(x,{icon:pe}),classes:"gold border-r-10",tooltip:"Carrello",linkTo:"/cart","data-cart-count":o()||null}))}catch{}let s=e?`${e} `:"";return r.jsxs("header",{className:`${s}page-header`,children:[le(t,"padding-1"),le(n,"padding-1-0 min-w-0"),le(a,"padding-1")]})}function le(e,t){return r.jsx("div",{className:t,children:e})}const Dr="60%",Rr="50%",zr="75%",Ur="30%",Ne=150,_r=window.matchMedia("(prefers-color-scheme: dark)").matches,M=Object.freeze({LIGHT:"light",DARK:"dark",AUTO:"auto"}),ye={[M.LIGHT]:gt,[M.DARK]:ft,[M.AUTO]:pt},Hr=Object.freeze({[M.LIGHT]:"chiaro",[M.DARK]:"scuro",[M.AUTO]:"sistema"}),Fr=Object.entries(ye).map(e=>({theme:e[0],icon:e[1]})),at=d.createContext(null),Lr=()=>{const e=d.useContext(at);if(!e)throw new Error("useTheme must be used within an ThemeProvider");return e};function wn({children:e}){const[t,n]=z("preferred-theme",M.AUTO),[a,s]=z("preferred-theme-color",Ne),o=qr(t)?t:M.AUTO;d.useEffect(()=>{l(o),p(a)},[]);const l=m=>{n(m),document.body.setAttribute("data-theme",m),u(m)},p=m=>{const c=typeof m!="number"?Ne:m%360;s(c),document.documentElement.style.setProperty("--theme-hue-primary",`${c}`)},u=m=>{let c=Dr,i=Rr;(m===M.LIGHT||m===M.AUTO&&!_r)&&(c=zr,i=Ur);const f=document.documentElement;f.style.setProperty("--theme-saturation-primary",`${c}`),f.style.setProperty("--theme-lightness-primary",`${i}`)};return r.jsx(at.Provider,{value:{theme:o,setTheme:l,color:a,setColor:p},children:e})}const qr=e=>Object.keys(ye).includes(e),R=Object.freeze({PROFILE:"profile",THEME:"theme",COLOR:"color"});function Gr({}){const{theme:e,setTheme:t,setColor:n}=Lr(),a=ye[e],[s,o]=d.useState(""),{profile:l,user:p,deleteAccount:u}=J(),{showConfirm:m}=B(),{showInfo:c}=D(),i=Y(),f=async()=>{if(!await m(`Procedere con l'eliminazione dell'account e i dati dei carrelli condivisi associati all'utente ${l?.email}?Questa operazione non è reversibile`))return;const h=await u();if(h&&h.redirect){i(h.redirect);return}c(`Account ${l?.email} eliminato`,{duration:5})},g=h=>{o(s!=h?h:"")};return r.jsx("div",{className:"flex flex-column bottom-separator-light",children:r.jsxs("div",{className:"flex flex-column sub-element-group",children:[p&&r.jsx(A,{text:"Profilo",tooltip:"profilo",icon:r.jsx(x,{icon:ht,color:"var(--primary-color)"}),classes:`${s!=R.PROFILE?"":"padding-bottom-0"} sub-element-list`,clickHandler:()=>g(R.PROFILE)}),s==R.PROFILE&&r.jsxs("div",{className:"flex flex-column sub-element-group sub-element-list",children:[l?.role===mr.ADMIN&&r.jsx(A,{text:"Gestione utenti",icon:r.jsx(et,{outer:r.jsx(x,{color:"var(--primary-color)",icon:jt}),inner:r.jsx(x,{color:"var(--main-color)",icon:xt})}),classes:"sub-element sub-element-list",tooltip:"Gestione utenti",linkTo:"/admin/users"}),r.jsx(A,{text:"Elimina account",icon:r.jsx(x,{color:"var(--accent-red)",icon:re}),classes:"sub-element sub-element-list",tooltip:"Cancella account",clickHandler:f})]}),r.jsx(A,{text:"Tema",tooltip:"Modifica tema",icon:r.jsx(x,{icon:a}),classes:`${s!=R.THEME?"":"padding-bottom-0"} sub-element-list`,clickHandler:()=>g(R.THEME)}),s==R.THEME&&r.jsx("div",{className:"flex flex-column sub-element-group sub-element-list",children:Fr.map(h=>r.jsx(A,{text:Hr[h.theme],icon:r.jsx(x,{icon:h.icon}),clickHandler:()=>t(h.theme),classes:"sub-element sub-element-list",tooltip:h.theme},h.theme))}),r.jsx(A,{text:"Colore",tooltip:"Modifica colore",icon:r.jsx(x,{icon:we,color:"var(--primary-color)"}),classes:`${s!=R.COLOR?"":"padding-bottom-0"} sub-element-list`,clickHandler:()=>g(R.COLOR)}),s==R.COLOR&&r.jsx("div",{className:"flex gap-05 padding-05 just-between sub-element-list",children:Br.map(h=>{const j=Vr(h);return r.jsx(w,{icon:r.jsx(x,{icon:we}),classes:"transparent border-r-10 sub-element",style:{backgroundColor:j},clickHandler:()=>n(h)},h)})})]})})}const Br=[0,30,150,210,310],Vr=e=>`hsl(${e}, var(--theme-saturation-primary), var(--theme-lightness-primary))`;function Nn({extraMenuItems:e}){const[t,n]=d.useState(!1),{user:a,logout:s}=J(),{showConfirm:o}=B(),l=Y(),p=Se(),[u,m]=d.useState(!1);d.useEffect(()=>{t||m(!1)},[t]);const c=async()=>{await o("Procedere con la disconnessione dall'account?")&&(await s(),a||l("/login"))},i=(g="",h=!1)=>{(h||g==p.pathname)&&n(!1)};function f(){return r.jsxs("div",{className:"page-container h-100 w-100 z-100 absolute top-0 main-bg",children:[r.jsx($r,{classes:"main-bg",right:r.jsx(w,{icon:r.jsx(x,{icon:ee}),classes:"red border-r-10",tooltip:"Chiudi",clickHandler:()=>i("",!0)}),left:r.jsx("h3",{className:"h-100 flex align-center",children:"Menu"})}),r.jsxs("div",{className:"flex flex-column",children:[r.jsx(A,{text:"Home",icon:r.jsx(x,{icon:bt}),classes:"primary-color top-separator-light bottom-separator-light",tooltip:"Home",linkTo:"/",clickHandler:()=>i("/")}),r.jsx(A,{text:"Preferiti",icon:r.jsx(x,{icon:fe}),classes:"gold bottom-separator-light",tooltip:"Preferiti",linkTo:"/favorites",clickHandler:()=>i("/favorites")}),r.jsx(A,{text:"Carrello",icon:r.jsx(x,{icon:ke}),classes:"gold bottom-separator-light",tooltip:"Carrello",linkTo:"/cart",clickHandler:()=>i("/cart")}),a&&r.jsx(A,{text:"Carrelli condivisi",icon:r.jsx(et,{outer:r.jsx(x,{color:"var(--accent-gold)",icon:pe}),inner:r.jsx(x,{color:"var(--primary-color)",icon:Ct})}),classes:"primary-color bottom-separator-light",tooltip:"Carrelli condivisi",linkTo:"/shared-carts",clickHandler:()=>i("/shared-carts")}),r.jsx(A,{text:"Impostazioni",icon:r.jsx(x,{icon:yt}),tooltip:"Impostazioni",classes:`main-color ${u?"padding-bottom-0":"bottom-separator-light"}`,clickHandler:()=>m(!u)}),u&&r.jsx(Gr,{}),a&&r.jsx(A,{text:"Logout",icon:r.jsx(x,{color:"var(--accent-red)",icon:It}),classes:"bottom-separator-light",tooltip:"Logout",clickHandler:c}),e?.map(g=>r.jsx(A,{...g}))]})]})}return r.jsxs(r.Fragment,{children:[r.jsx("div",{id:"main-menu",children:r.jsx(w,{icon:r.jsx(x,{icon:vt}),classes:"primary-color border-r-10",clickHandler:()=>n(!0),tooltip:"Apri menu"})}),t&&Ee.createPortal(f(),document.getElementById("root"))]})}function En({left:e,center:t,right:n,classes:a}){const s=a?`${a} `:"";return r.jsxs("footer",{className:`${s}page-footer`,children:[r.jsx("div",{className:"padding-1",children:e}),r.jsx("div",{className:"padding-1-0",children:t}),r.jsx("div",{className:"padding-1 flex just-end",children:n})]})}function Sn({}){const{getItemsCount:e,getTotalPrice:t}=F(),[n,a]=d.useState(!1),s=e(),o=t($.PAYPAL),l=t($.CASH);return r.jsxs("section",{className:"cart-info flex flex-center gap-1 flex-column pointer",onClick:()=>a(!n),children:[r.jsxs("div",{className:"flex gap-2 cart-info-summary",children:[r.jsxs("div",{className:"flex gap-05",children:[r.jsx(x,{icon:wt}),r.jsx("span",{children:s})]}),r.jsxs("div",{className:"flex gap-05",children:[t().toFixed(2)," €"]}),s>0&&r.jsx(x,{icon:Te,className:`absolute right-0 ${n&&"rotate-180"}`})]}),n&&t()!=0&&r.jsxs("div",{className:"cart-price-detail flex gap-2",children:[o>0&&r.jsxs("span",{className:"flex gap-05 align-center",children:[r.jsx(x,{icon:Ae}),r.jsxs("span",{children:[o.toFixed(2)," €"]})]}),l>0&&r.jsxs("span",{className:"flex gap-05 align-center",children:[r.jsx(x,{icon:Pe}),r.jsxs("span",{children:[l.toFixed(2)," €"]})]})]}),r.jsxs("div",{className:"flex w-100 gap-1",children:[r.jsxs(de,{className:"flex-1 flex flex-center padding-1 new-cart-poke gap-05",title:"Aggiungi poke",to:"/poke-configurator",children:[r.jsx(x,{icon:Oe}),"Poke"]}),r.jsxs(de,{className:"flex-1 flex flex-center padding-1 new-cart-dish gap-05",title:"Aggiungi piatti da menu",to:"/menu",children:[r.jsx(x,{icon:Nt}),"Menu"]})]})]})}function kn({}){const{cart:e}=F(),{showAlert:t}=B(),{showInfo:n}=D(),a=async()=>{const s=`${window.location.origin}${window.location.pathname}/invite/${e.id}/${encodeURIComponent(e.name)}`;console.log(s),navigator.clipboard?(await navigator.clipboard.writeText(s),n("Link di invito copiato negli appunti",{duration:5})):t(`${s}`)};return r.jsxs("h3",{className:"h-100 flex flex-center gap-05 flex-column",children:[r.jsxs("span",{className:"flex gap-05 just-center w-100",children:[e.isShared&&r.jsx(x,{icon:Et,title:"Carello condiviso"}),r.jsx("span",{className:"ellipsis",children:e.name})]}),e.isShared&&r.jsx("span",{className:"fake-link text-small text-center",onClick:a,children:"Genera link di invito"})]})}const st=d.memo(Jr,Qr);function Qr(e,t){if(!t.useMemo)return!1;const n=e.item,a=t.item;return _(n)&&_(a)?Kr(n,a)&&e.disabled===t.disabled:H(n)&&H(a)?Yr(n,a)&&e.disabled===t.disabled:!1}function Yr(e,t){if(e.dishes.length!=t.dishes.length)return!1;const n=e.dishes.sort((s,o)=>s.id.localeCompare(o.id)),a=t.dishes.sort((s,o)=>s.id.localeCompare(o.id));for(let s=0;s<n.length;s++){const o=n[s],l=a[s];if(o.id!=l.id||o.quantity!=l.quantity)return!1}return!0}function Kr(e,t){const{ingredients:n,...a}=e,{ingredients:s,...o}=t;if(!hr(a,o))return!1;const l=Object.keys(n),p=Object.keys(s);if(l.length!=p.length)return!1;for(const u of l){const m=n[u],c=s[u];if(m.length!=c.length)return!1;const i=[...m].sort((g,h)=>g.id.localeCompare(h.id)),f=[...c].sort((g,h)=>g.id.localeCompare(h.id));for(let g=0;g<i.length;g++)if(i[g].id!==f[g].id||i[g].quantity!==f[g].quantity||q(i[g].id)!==q(f[g].id))return!1}return!0}function Jr({item:e,disabled:t=!1,actions:n}){const[a,s]=d.useState(!1),o=u=>{const m=u.target;s(m.open)},l=_(e)?ve(e.size,e.ingredients):H(e)?je(e.dishes):0,p=t?"item-disabled ":"";return r.jsx("div",{className:`${p}cart-item-container`,children:r.jsxs("details",{onToggle:o,children:[r.jsxs("summary",{className:"cart-item-summary flex align-center just-between padding-1 gap-05",children:[r.jsxs("span",{className:"ellipsis",children:[r.jsx(x,{className:"cart-item-pay",icon:e.paymentMethod==$.CASH?Pe:Ae}),e.name]}),r.jsxs("div",{className:`flex align-center just-end min-w-fit ${a?"":"gap-05"}`,children:[r.jsxs("span",{className:"cart-item-price",children:[l.toFixed(2)," €"]}),r.jsx("div",{className:"h-button-icon"}),!a&&n.slice(-1)]})]}),r.jsxs("div",{className:"cart-item-extra-info",children:[r.jsx("div",{className:"cart-item-description padding-1-0",children:ue(e)}),r.jsx("div",{className:"cart-item-actions flex just-between",children:n})]})]})})}const ot=d.createContext(null),it=d.createContext(null),ct=()=>{const e=d.useContext(ot);if(!e)throw new Error("useFavorite must be used within an FavoriteProvider");const t=d.useContext(it);if(!t)throw new Error("useFavorite must be used within an FavoriteProvider");return{...e,...t}};function Tn({}){const[e,t]=z("poke-favorites",[]),{showConfirm:n}=B(),{showInfo:a,showError:s}=D(),o=async(c,i)=>{t(f=>{let g=c.id;const h=structuredClone(c);return h.createdBy="",i&&(h.id=crypto.randomUUID()),f.find(v=>v.id==h.id)?(queueMicrotask(()=>s("Elemento già salvato nei preferiti")),f):(queueMicrotask(()=>{a(i?"Elemento aggiornato nei preferiti":"Elemento salvato nei preferiti")}),[...f.filter(v=>v.id!==g),h])})},l=c=>{const i=e.find(g=>g.id==c);if(!i)return;const f=structuredClone(i);f.id=crypto.randomUUID(),o(f)},p=async(c,i)=>{await n(`Confermare la cancellazione dell'elemento ${i}`)&&t(f=>[...f.filter(g=>g.id!=c)])},u=async()=>{await n("Confermare la cancellazione di tutti i preferiti?")&&t([])},m=d.useMemo(()=>({hasItem:c=>Be(e,c)}),[e]);return r.jsx(it.Provider,{value:m,children:r.jsx(ot.Provider,{value:{favorites:e,addFavorite:o,removeFavorite:p,removeAllFavorites:u,duplicateItem:l},children:r.jsx(te,{})})})}function An({item:e,disabled:t,deleteItem:n,duplicate:a,useMemo:s=!1}){const{loadItemIntoConfigurator:o}=W(),{loadDishesIntoMenu:l}=be(),{addFavorite:p,hasItem:u}=ct(),m=(i,f)=>{if(_(i))return o(i,f);if(H(i))return l(i,f)},c=u(e.id);return r.jsx(st,{item:e,disabled:t,useMemo:s,actions:[r.jsx(w,{tooltip:"Modifica elemento",icon:r.jsx(x,{icon:Me}),classes:"small border-r-10 primary-color",clickHandler:()=>m(e,!0),disabled:t,disabledMessage:"Non è possibile modificare l'elemento di un altro utente"},"edit"),r.jsx(w,{tooltip:"Aggiungi ai preferiti",icon:r.jsx(x,{icon:fe}),classes:"small border-r-10 gold",disabled:c||t,disabledMessage:c?"Elemento già presente nei preferiti":"Elemento appartenente ad un altro utente",clickHandler:()=>{p(e)}},"addCart"),r.jsx(w,{tooltip:"Duplica elemento",icon:r.jsx(x,{icon:$e}),classes:"small border-r-10 primary-color",clickHandler:()=>{a(e.id)}},"duplicate"),r.jsx(w,{tooltip:"Cancella elemento",icon:r.jsx(x,{icon:re}),classes:"small border-r-10 red",clickHandler:()=>{n(e.id,e.name)},disabled:t,disabledMessage:"Non è possibile eliminare l'elemento di un altro utente"},"delete")]})}function Pn({hideModal:e}){const[t,n]=z("poke-order-name",""),[a,s]=z("poke-order-time",""),[o,l]=d.useState(""),{cart:p,getTotalPrice:u}=F(),[m,c]=d.useState(""),i=d.useRef(null);d.useEffect(()=>{f()},[t,a,p]),d.useEffect(()=>{CSS.supports("field-sizing","content")||(console.log("field-sizing not suppoter -> manual workaround"),i.current&&(i.current.style.height=i.current.scrollHeight+3+"px"))},[m]);const f=()=>{const j=Object.values(p.items||{}),v=Wr(j,t,a);c(v)},g=j=>{const v=j.target.value;if(!v){l("Scegliere un orario per il rititiro prima di procedere");return}l(""),s(v)},h=()=>{if(!a){l("Scegliere un orario per il rititiro prima di procedere");return}window.open(`https://wa.me/?text=${encodeURIComponent(m)}`),e()};return r.jsx(oe,{title:"Completa l'ordine",hideModal:e,autoFocus:!0,actions:[r.jsx(V,{text:"Conferma",classes:"primary-bg primary-contrast-color border-r-10",tooltip:"Salva nei preferiti",clickHandler:h},"confirm"),r.jsx(V,{text:"Annulla",classes:"red main-bg border-r-10",tooltip:"Annulla",clickHandler:e},"cancel")],actionsClasses:"just-between",content:r.jsxs("div",{id:"order-preview-container",children:[r.jsxs("div",{className:"group",children:[r.jsx("label",{htmlFor:"order-name",className:"group-label",children:"Nome"}),r.jsx("input",{type:"text",name:"order-name",id:"order-name",className:"flex-1",value:t,onChange:j=>n(j.target.value)})]}),r.jsxs("div",{className:"flex flex-column",children:[r.jsxs("div",{className:"group",children:[r.jsx("label",{htmlFor:"order-time",className:"group-label",children:"Orario"}),r.jsx("input",{type:"time",name:"order-time",id:"order-time",value:a,onChange:g})]}),r.jsx("div",{id:"order-time-error",className:"error-message",children:o})]}),r.jsxs("div",{className:"group",children:[r.jsx("span",{className:"group-label",children:"Totale"}),r.jsxs("span",{id:"order-price",children:[u().toFixed(2)," €"]})]}),r.jsx("textarea",{ref:i,id:"order-message",value:m,onChange:j=>c(j.target.value)})]})})}function Wr(e,t,n){const a=e.filter(i=>_(i)),s=e.filter(i=>H(i)),o=[],l=[];for(const[i,f]of Object.entries(a))o.push(`${Number(i)+1}) ${ue(f)}`);for(const[i,f]of Object.entries(s))l.push(`${Number(i)+1}) ${ue(f,!0).replaceAll(new RegExp("(?<=\\n)","gm"),"   ")}`);const p=a.length,u=s.reduce((i,f)=>i+f.dishes.reduce((g,h)=>g+h.quantity,0),0);let c=Xr(p,u,t,n);if(p>0&&(c+=`
`,u>0&&(c+=`
${p>0?"Poke:":""}`),c+=`
${o.join(`
\r`)}`),u>0){c+=`
`;const i="(possibilmente raggruppati come segue)";p>0?c+=`
${u>0?`Piatti${s.length>1?` ${i}`:""}:`:""}`:s.length>1&&(c+=`
${i}`),c+=`
${l.join(`
\r`)}`}return c}function Xr(e,t,n,a){let o=`${new Date().getHours()>14?"Buonasera":"Buongiorno"},`;return o+=`
vorrei ordinare`,e>0&&(o+=` ${e} poke`),e>0&&t>0&&(o+=" e"),t>0&&(o+=` ${t}`,t===1?o+=" piatto":o+=" piatti"),o+=` da asporto per le ${a}.`,n&&(o+=` a nome: ${n}`),o}function On({setIsOpen:e,callback:t,linkLocalCart:n=!1}){const[a,s]=d.useState(""),[o,l]=d.useState(!1),{createCart:p}=F(),{showError:u}=D(),m=Y();d.useEffect(()=>{l(n)},[]);const c=async i=>{if(i.preventDefault(),!a)return;if(!await p(a,o)){u("Errore creazione carrello condiviso!");return}t&&t(),m("/cart")};return r.jsx(oe,{hideModal:()=>e(!1),autoFocus:!0,title:"Nuovo carrello condiviso",titleClasses:"text-center",actions:[r.jsx(w,{icon:r.jsx(x,{icon:St}),classes:"primary-color border-r-10",tooltip:"Salva nel carrello",clickHandler:c},"save"),r.jsx(w,{icon:r.jsx(x,{icon:ee}),classes:"red main-bg border-r-10",tooltip:"Annulla",clickHandler:()=>e(!1),type:"reset"},"cancel")],actionsClasses:"just-between",content:r.jsxs(r.Fragment,{children:[r.jsx("input",{type:"text",placeholder:"Nome",className:"text-large text-center margin-1-0 w-100",onChange:i=>s(i.target.value),value:a,required:!0}),r.jsxs("div",{className:"flex flex-center gap-1 padding-1-0 pointer",title:"Utilizza i dati del carrello attualmente attivo",children:[r.jsx("label",{htmlFor:"use-local-cart",children:"Condivi carrello locale"}),r.jsx("label",{htmlFor:"use-local-cart",className:`checkbox ${o?"checked":""}`}),r.jsx("input",{id:"use-local-cart",type:"checkbox",className:"text-large text-center margin-1-0 w-100",onChange:i=>l(i.target.checked),checked:o})]})]})})}function Mn({item:e,deleteItem:t,duplicate:n,useMemo:a=!1}){const{loadItemIntoConfigurator:s}=W(),{loadDishesIntoMenu:o}=be(),{addItem:l,hasItem:p}=F(),u=(c,i)=>{if(_(c))return s(c,i);if(H(c))return o(c,i)},m=p(e.id);return r.jsx(st,{item:e,useMemo:a,actions:[r.jsx(w,{tooltip:"Modifica elemento",icon:r.jsx(x,{icon:Me}),classes:"small border-r-10 primary-color",clickHandler:()=>u(e,!0)},"edit"),r.jsx(w,{tooltip:"Aggiungi al carrello",icon:r.jsx(x,{icon:ke}),classes:"small border-r-10 gold",disabled:m,disabledMessage:"Elemento già presente nel carrello",clickHandler:()=>{l(e)}},"addCart"),r.jsx(w,{tooltip:"Duplica elemento",icon:r.jsx(x,{icon:$e}),classes:"small border-r-10 primary-color",clickHandler:()=>{n(e.id)}},"duplicate"),r.jsx(w,{tooltip:"Cancella elemento",icon:r.jsx(x,{icon:re}),classes:"small border-r-10 red",clickHandler:()=>{t(e.id,e.name)}},"delete")]})}function $n({cart:e,activeCartId:t,deleteSharedCart:n,unlinkSharedCart:a,loadCartAsActive:s}){const o=t===e.id,l=Object.keys(e.items||{}).length;return r.jsxs("div",{className:`shared-cart flex align-center just-between ${o?"border-primary":""}`,children:[r.jsx("div",{className:"ellipsis",title:e.name,children:e.name}),r.jsxs("div",{className:"flex gap-05",children:[r.jsxs("div",{className:"flex flex-center gap-05",title:"Elementi nel carrello",children:[r.jsx("span",{children:l}),r.jsx("span",{children:r.jsx(x,{icon:Oe})})]}),r.jsx(w,{icon:r.jsx(x,{icon:re}),classes:"small red border-r-10",tooltip:"Cancella carrello",clickHandler:()=>n(e,e.name)}),o?r.jsx(w,{icon:r.jsx(x,{icon:kt}),classes:"small red border-r-10",tooltip:"Scollega carrello",clickHandler:()=>a()}):r.jsx(w,{icon:r.jsx(x,{icon:Tt}),classes:"small primary-color border-r-10",tooltip:"Carica come carrello attivo",clickHandler:()=>s(e.id)})]})]},e.id)}function Dn({tabsName:e,tabsContent:t}){const[n,a]=d.useState(0);return r.jsxs(r.Fragment,{children:[Zr(e,n,a),en(t,n)]})}const Zr=(e,t,n)=>r.jsx("h4",{className:"tabbed-header flex just-between main-bg sticky top-0",children:e.map((a,s)=>{const o=t===s?"primary-color":"";return r.jsx("span",{onClick:()=>n(s),className:`flex-1 padding-1 text-center text-uppercase pointer ${o}`,children:a},a.replace(" ","-"))})}),en=(e,t)=>t>e.length?null:e[t];function Rn({source:e,hideModal:t}){const{user:n}=J(),{showError:a}=D(),{addFavorite:s}=ct(),{addItem:o}=F(),{ingredients:l,resetContext:p,size:u,editingId:m,setEditingId:c}=W(),{dishes:i,editingId:f,setEditingId:g,resetContext:h}=be(),{name:j,setName:v,paymentMethod:I,setPaymentMethod:y}=Ce(),O=C=>{const lt=C.target.checked?$.PAYPAL:$.CASH;y(lt)},L=C=>{let P;if(e=="poke")P={id:m||crypto.randomUUID(),name:j,createdBy:n?.uid||"",paymentMethod:I,ingredients:l,size:u};else if(e=="dish")P={id:f||crypto.randomUUID(),name:j,createdBy:n?.uid||"",paymentMethod:I,dishes:i};else{console.warn("Unknown save source");return}switch(C){case"cart":b(P);break;case"favorite":S(P);break;default:a("Destinazione di salvataggio non valida");break}c(""),g(""),p(),h(),t()},b=C=>{const P="size"in C?m:f;o(C,!!P)},S=C=>{const P="size"in C?m:f;s(C,!!P)};return r.jsx(oe,{autoFocus:!0,title:`${e=="poke"?"Salva poke":"Salva piatti"}`,titleClasses:"text-center",hideModal:t,actions:[r.jsx(w,{icon:r.jsx(x,{icon:fe}),classes:"gold border-r-10",tooltip:"Salva nei preferiti",clickHandler:()=>L("favorite")},"saveFavotires"),r.jsx(w,{icon:r.jsx(x,{icon:ee}),classes:"red main-bg border-r-10",tooltip:"Annulla",clickHandler:t},"cancel"),r.jsx(w,{icon:r.jsx(x,{icon:pe}),classes:"gold border-r-10",tooltip:"Salva nel carrello",clickHandler:()=>L("cart")},"saveCart")],actionsClasses:"just-between",content:r.jsxs(r.Fragment,{children:[r.jsx("input",{type:"text",placeholder:"Nome",className:"text-large text-center margin-1-0 w-100",onChange:C=>v(C.target.value),value:j}),r.jsx("h4",{className:"text-center",children:"Metodo di pagamento"}),r.jsxs("div",{id:"payment-toogle-container",className:"flex align-center just-center",children:[r.jsx("input",{type:"checkbox",name:"payment-method",id:"payment-method",className:"custom-toggle-input",onChange:O,checked:I===$.PAYPAL}),r.jsx("label",{id:"cash",htmlFor:"payment-method",className:"pointer flex-1 toggle toggle-left text-center disabled",children:"Contanti"}),r.jsx("label",{className:"custom-toogle pointer",htmlFor:"payment-method"}),r.jsx("label",{id:"paypal",htmlFor:"payment-method",className:"pointer flex-1 toggle toggle-right text-center disabled",children:"PayPal"})]})]})})}function tn({dish:e,dishId:t,quantity:n,isSelected:a,addDish:s,removeDish:o,increaseQuantity:l}){const p=a?"selected ":"";function u(m){m.target.checked?s(t):o(t)}return r.jsxs("div",{className:`${p}dish-container relative`,...n>1?{"data-extra":n}:{},children:[r.jsxs("label",{htmlFor:t,className:"flex flex-column pointer",children:[r.jsxs("div",{className:"flex gap-05",children:[r.jsx("span",{className:"dish-code",children:e.code}),"-",r.jsx("span",{className:"dish-name",children:e.name})]}),r.jsxs("span",{className:"dish-price flex text-small",children:[e.price," €"]})]}),r.jsx("input",{type:"checkbox",name:t,id:t,checked:a,onChange:u}),a&&r.jsx(w,{icon:r.jsx(x,{icon:De}),classes:"add-extra flex flex-center transparent-bg h-100 aspect-1 border-round no-active right-0 absolute",clickHandler:()=>l(t),tooltip:"Aggiungi copia"})]})}function zn({category:e,dishes:t,addDish:n,removeDish:a,increaseQuantity:s}){const[o,l]=d.useState(!1),p=c=>{const i=c.target;l(i.open)},u=t.reduce((c,i)=>c+i.quantity,0),m=u>0?"selected":"";return r.jsxs("details",{onToggle:p,children:[r.jsxs("summary",{className:`dish-menu-category-header pointer sticky top-0 main-bg padding-1-0 text-uppercase text-center weight-bold z-1 ${m}`,children:[r.jsx("span",{"data-dish-count":u>0?u:null,children:e}),r.jsx(x,{icon:Te,className:`absolute right-1 ${o&&"rotate-180"}`})]}),r.jsx("div",{className:"flex flex-column gap-1 padding-0-1",children:rn(t,n,a,s)})]})}function rn(e,t,n,a){return e.length==0?r.jsx("span",{className:"text-center",children:"Ops, sembra che non ci siano ancora elementi in questa categoria"}):e.map(s=>{const o=ie(s.name);return r.jsx(tn,{dish:s,dishId:o,quantity:s.quantity,isSelected:s.selected,addDish:t,removeDish:n,increaseQuantity:a},o)})}function nn({count:e,limit:t,extraPrice:n}){const a=e-t;return r.jsxs("div",{className:"group-count-price",children:[r.jsxs("span",{className:"group-count",children:[r.jsx("span",{children:e}),"/",r.jsx("span",{children:t})]}),a>0&&r.jsxs("span",{className:"extra-price",children:["+",r.jsx("span",{children:n.toFixed(2)}),"€"]})]})}function an({ingredientId:e,ingredientName:t,ingredientQuantity:n,addIngredient:a,removeIngredient:s,increaseQuantity:o,isSelected:l=!1}){const p=l?"selected ":"";function u(m){m.target.checked?a(e):s(e)}return r.jsxs("div",{className:`${p}ingredient-container relative`,...n>1?{"data-extra":n}:{},title:`${l?"Rimuovi ingrediente":"Aggiungi ingrediente"}`,children:[r.jsx("label",{htmlFor:e,className:"ingredient-name",children:t}),r.jsx("input",{type:"checkbox",id:e,checked:l,onChange:u}),l&&r.jsx(w,{icon:r.jsx(x,{icon:De}),classes:"flex flex-center transparent-bg h-100 aspect-1 border-round no-active right-0 absolute",clickHandler:()=>o(e),tooltip:"Aggiungi copia"})]})}function Un({group:e}){const{ingredients:t,groupCount:n,groupExtraPrice:a,getLimit:s,addIngredient:o,increaseQuantity:l,removeIngredient:p}=W(),u=e.options,m=n(e.id),c=s(e.id),i=h=>o(e.id,h),f=h=>p(e.id,h),g=h=>l(e.id,h);return r.jsxs("section",{className:"ingredient-group",children:[r.jsxs("div",{className:"ingredient-group-header text-uppercase",children:[r.jsx("h3",{className:"ingredient-group-name",children:e.id}),r.jsx(nn,{count:m,limit:c,extraPrice:m>c?a(e.id):0}),r.jsx("h4",{className:"extra-label text-center",children:e.extras})]}),r.jsx("div",{className:"ingredient-group-container",children:u.map(h=>{const j=ie(h.name),v=t[e.id]?.find(y=>y.id==j),I=!!v;return r.jsx(an,{ingredientId:j,ingredientName:h.name,ingredientQuantity:v?.quantity||0,addIngredient:i,removeIngredient:f,increaseQuantity:g,isSelected:I},j)})})]})}function sn({name:e,price:t,limits:n}){const{size:a,selectSize:s}=W(),o=`size-${e}`,l=e===a?"selected":"";return r.jsx("div",{className:`size-container${" "+l}`,children:r.jsxs("label",{htmlFor:o,children:[r.jsx("input",{type:"radio",name:"size",id:o,onClick:()=>s(e)}),r.jsxs("div",{className:"flex flex-column flex-center gap-05 padding-1",children:[r.jsx("span",{className:"size-name text-uppercase text-large weight-bold",children:e}),r.jsx("span",{className:"size-limits",children:on(n)}),r.jsxs("span",{className:"size-price",children:[t.toFixed(2)," €"]})]})]})})}function on(e){return Object.entries(e).map(t=>{const n=t[0],a=t[1];return r.jsxs("span",{className:"limit",children:[a," ",n]},n)})}function _n({sizes:e}){const t=()=>e.map(n=>{const a={name:n[0],...n[1]};return r.jsx(sn,{name:a.name,price:a.price,limits:a.limits},a.name)});return r.jsx("section",{id:"size-selector-container",children:t()})}export{vn as A,V as B,kn as C,zn as D,Cn as E,Mn as F,Tn as G,In as H,Un as I,yn as J,nr as L,Nn as M,Pn as O,$r as P,$n as S,Dn as T,bn as U,En as a,B as b,D as c,F as d,w as e,Sn as f,On as g,An as h,ct as i,un as j,mn as k,Yt as l,gn as m,fn as n,pn as o,be as p,Rn as q,hn as r,ie as s,W as t,J as u,_n as v,xn as w,jn as x,wn as y,K as z};

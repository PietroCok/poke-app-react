import{j as n,R as it,r as m,f as K,a as ct,b as lt,N as dt,c as je,u as W,O as X,d as ut,e as xe,g as mt,h as pt,i as ft,k as gt,l as Z,m as ht,n as xt,o as vt,p as be,q as jt,s as bt,t as ce,v as yt,w as le,x as ye,y as Ce,z as Ie,A as we,B as Ct,C as Ne,D as Se,E as It,F as wt,G as Nt,H as St,I as ke}from"./react-DsNixYkS.js";import{F as g}from"./fontawesome-BCH0MxRp.js";import{i as kt,g as Et,a as H,r as N,o as Tt,b as ee,u as te,s as de,c as At,d as Pt,F as re,e as Mt,f as Ot,h as $t,j as Dt,A as Rt,k as _t}from"./firebase-BW08cwwr.js";const Ut={regular:{limits:{proteine:1,condimenti:4,croccantini:2,salse:3},price:8.9},large:{limits:{proteine:2,condimenti:5,croccantini:2,salse:3},price:10.9}},zt={proteine:{extras:"extra salmone tonno crudo € 2.00 / altri € 1.50",options:[{name:"salmone crudo",price:2},{name:"tonno crudo",price:2},{name:"salmone cotto",price:1.5},{name:"tonno sott'olio",price:1.5},{name:"gamberi cotti",price:1.5},{name:"tempura di gamberi",price:1.5},{name:"cotoletta di pollo",price:1.5},{name:"pollo cotto",price:1.5},{name:"tofu fresco",price:1.5},{name:"uova sode",price:1.5},{name:"uova al tegamino",price:1.5}],order:0},condimenti:{extras:"extra € 0.50",options:[{name:"alghe wakame",price:.5},{name:"mais",price:.5},{name:"avocado",price:.5},{name:"ceci",price:.5},{name:"pomodorino",price:.5},{name:"edamame",price:.5},{name:"peperoni",price:.5},{name:"fagioli",price:.5},{name:"cetrioli",price:.5},{name:"mango",price:.5},{name:"carote",price:.5},{name:"zenzero",price:.5},{name:"ananas",price:.5},{name:"olive nere",price:.5}],order:1},croccantini:{extras:"extra € 0.50",options:[{name:"anacardi",price:.5},{name:"mandorle",price:.5},{name:"alghe nori",price:.5},{name:"sesamo",price:.5},{name:"tobico",price:.5},{name:"kataifi",price:.5},{name:"noci",price:.5},{name:"cipolla croccante",price:.5},{name:"pistacchio",price:.5}],order:2},salse:{extras:"extra € 0.50",options:[{name:"olio di oliva",price:.5},{name:"aceto balsamico",price:.5},{name:"soia",price:.5},{name:"maionese",price:.5},{name:"philadelphia",price:.5},{name:"teriyaki",price:.5},{name:"wasabi",price:.5},{name:"spicy maionese",price:.5},{name:"salsa mango",price:.5},{name:"salsa ponzu",price:.5},{name:"salsa agrodolce",price:.5},{name:"salsa agropiccante",price:.5},{name:"salsa yogurt",price:.5}],order:3}},Ft={antipasti:[{name:"involtini primavera",price:2,code:"1"},{name:"goma wakame",price:4,code:"2"},{name:"nuvolette di gamberi",price:2,code:"3"},{name:"verdura agropiccante",price:4,code:"4"},{name:"toast di gamberi",price:4,code:"4a"},{name:"antipasto assortito",price:4,code:"5"},{name:"antipasto di mare freddo",price:5,code:"5a"},{name:"frutti di mare fritti",price:6,code:"6"},{name:"vedrura mista fritto",price:4,code:"7"},{name:"cocktail di gamberi",price:6,code:"7a"},{name:"ravioli con carne al vapore",price:4,code:"8"},{name:"ravioli di verdure al vapore",price:4,code:"8a"},{name:"ravioli alla griglia",price:4,code:"9"},{name:"ciao mai (ravioli misti carne e pesce)",price:4,code:"10"},{name:"patate fritte",price:3,code:"11"},{name:"ravioli di gamberi",price:4,code:"11a"}],zuppe:[{name:"zuppa pechinese",price:4,code:"12"},{name:"zuppa mais",price:4,code:"14"},{name:"zuppa spaghetti di soia con funghi",price:4,code:"15"},{name:"zuppa di granchio e asparagi",price:4,code:"16"}],"paste e riso":[{name:"riso alla cantonese",price:4,code:"18"},{name:"riso con gamberetti",price:4.5,code:"19"},{name:"riso con gamberi carne e pollo piccante",price:4.5,code:"19a"},{name:"riso con curry",price:4,code:"20"},{name:"riso con verdure",price:4,code:"20a"},{name:"riso con frutti di mare",price:5,code:"21"},{name:"gnocchi di riso con gamberretti",price:4,code:"22"},{name:"spaghetti di riso cinesi",price:4,code:"23"},{name:"spaghetti di soia con carne piccanti",price:4,code:"24"},{name:"spaghetti di soia con verdure",price:4,code:"25"},{name:"spaghetti di soia con gamberretti",price:4.5,code:"25a"},{name:"spaghetti con gamberreti",price:4.5,code:"26"},{name:"spaghetti con verdure",price:4,code:"27"},{name:"spaghetti alla piastra con frutti di mare",price:5,code:"28"},{name:"riso bianco",price:2,code:"29a"}],pollo:[{name:"pollo con mandorle",price:5,code:"30"},{name:"pollo con verdure miste",price:5,code:"31"},{name:"pollo con bambu e funghi cinesi",price:5,code:"32"},{name:"pollo in salsa agro dolce",price:5,code:"33"},{name:"pollo piccante",price:5,code:"34"},{name:"pollo al curry",price:5,code:"35"},{name:"pollo fritto",price:5,code:"36"},{name:"pollo al limone",price:5,code:"37"},{name:"pollo con gamberetti e funghi",price:5,code:"38"},{name:"pollo con anacardi",price:5,code:"39a"},{name:"spiedini di pollo alla griglia",price:5,code:"01"}],maiale:[{code:"50",name:"maiale piccante",price:5},{code:"51",name:"maiale con verdure miste",price:5},{code:"52",name:"maiale con fughi e bambu",price:5},{code:"53",name:"maiale in salsa agro dolce",price:5},{code:"54",name:"puntine di maiale alla griglia",price:5},{code:"56",name:"maiale alla piastra",price:5}],manzo:[{code:"60",name:"manzo con cipolle",price:6},{code:"61",name:"manzo con verdure miste",price:6},{code:"62",name:"manzo con bambu e funghi",price:6},{code:"63",name:"manzo piccante",price:6},{code:"64",name:"manzo con peperoni",price:6},{code:"66",name:"manzo alla piastra",price:6}],gamberetti:[{code:"70",name:"gamberetti fritti",price:6},{code:"71",name:"gamberetti con verdure miste",price:6},{code:"72",name:"gamberetti bambu e funghi",price:6},{code:"73",name:"gamberetti agro dolce",price:6},{code:"74",name:"gamberetti alla griglia",price:6},{code:"75",name:"gamberetti sei colori",price:6},{code:"76",name:"gamberetti con limone",price:6},{code:"77",name:"gamberetti alla piastra",price:7},{code:"78",name:"gamberetti al curry",price:6},{code:"79",name:"gamberetti piccanti",price:6},{code:"03",name:"spiedini di gamberi alla griglia",price:6}],calamari:[{code:"84",name:"calamari fritti",price:6},{code:"85",name:"calamari con pepperoni",price:6},{code:"86",name:"calamari piccante",price:6},{code:"87",name:"calamari alla piastra",price:6},{code:"87a",name:"calamari bambu e funghi",price:6},{code:"93",name:"frutti di mare alla piastra",price:8}],gamberoni:[{code:"95",name:"gamberoni piccante",price:8},{code:"96",name:"gamberoni stufati",price:8},{code:"97",name:"gamberoni alla griglia",price:8},{code:"98",name:"gamberoni alla piastra",price:8}],omelette:[{code:"100",name:"omelette con gamberi",price:4},{code:"101",name:"omelette con granchio",price:4},{code:"102",name:"omelette con pollo",price:4}],contorni:[{code:"103",name:"insalata con gamberi",price:4},{code:"104",name:"insalata con granchio",price:4},{code:"105",name:"verdure mista alla piastra",price:4.5},{code:"106",name:"bambu con funghi",price:4},{code:"106a",name:"funghi saltato",price:4.5},{code:"107",name:"verdure mista saltati",price:4}],dessert:[{code:"201",name:"Gelato fritto",price:4},{code:"202",name:"Latte fritto",price:4},{code:"203",name:"Nutella fritto",price:4},{code:"204",name:"Frutta mista fritti",price:4},{code:"205",name:"Gelato tartufo nero e bianco",price:4},{code:"206",name:"Macedonia mista",price:4},{code:"207",name:"Ananas fresco",price:4}]},G={sizes:Ut,groups:zt,menu:Ft},Ee={apiKey:"AIzaSyBT-bk__Ft7uiBIRA9SriDdvVsHPFLp8B8",authDomain:"testing-grounds-d59c4.firebaseapp.com",databaseURL:"https://testing-grounds-d59c4-default-rtdb.europe-west1.firebasedatabase.app",projectId:"testing-grounds-d59c4",storageBucket:"testing-grounds-d59c4.firebasestorage.app",messagingSenderId:"934551744902",appId:"1:934551744902:web:ab91aec74058e5c2b83c07"};console.log("Firebase configuration",Ee);const Te=kt(Ee),S=Et(Te);console.log("Firebase Database Initialized!");const Ht=async e=>{if(!e.email||!e.uid)return console.warn("Unable to create user record: missing email or uid!"),null;const t={email:e.email,status:"pending",createdAt:new Date().toISOString()};try{await de(N(S,`/users/${e.uid}`),t)}catch(a){return console.warn(a),null}return console.log("User record created on db"),{...t,role:"basic",uid:e.uid}},Lt=async e=>{try{const t=await Bt(e)||[];for(const r of t)r.createdBy===e?await Ae(r.id):await ue(r.id,e);return await ee(N(S,`/users/${e}`)),!0}catch(t){console.warn(t)}return!1},qt=async e=>{try{const t=await H(N(S,`/users/${e.uid}`));if(t.exists()){const{email:r,role:a,status:s,createdAt:o}=t.val();return{email:r,role:a,status:s,createdAt:o,uid:e.uid}}else return await Ht(e)}catch(t){return console.warn(t),null}},sn=async()=>{try{const e=await H(N(S,"/users"));if(e.exists()){const t=e.val(),r=[];for(const[a,s]of Object.entries(t))r.push({...s,uid:a});return r}else return[]}catch(e){return console.warn(e),[]}},on=async(e,t)=>{if(!e||!t)return console.warn("updateUserStatus: One or more invalid parameters"),!1;try{return await te(N(S,`/users/${e}`),{status:t}),!0}catch(r){return console.warn(r),!1}},Gt=async e=>{const t={};t[`/shared-carts/cart-${e.id}`]=e,t[`/users/${e.createdBy}/carts/cart-${e.id}/`]=!0;try{return await te(N(S),t),!0}catch(r){console.warn(r)}return!1},cn=async e=>{try{const t=await H(N(S,`/shared-carts/cart-${e}/`));if(t.exists())return t.val()}catch(t){console.warn(t)}return null},Bt=async e=>{let t={};try{const a=await H(N(S,`users/${e}/carts/`));a.exists()&&(t=a.val())}catch{return null}const r=[];for(const a in t)try{const s=await H(N(S,`shared-carts/${a}/`));s.exists()?r.push(s.val()):ue(a,e)}catch(s){console.warn(s)}return r},ln=async(e,t)=>{try{return await te(N(S,`/users/${t}/carts/`),{[`cart-${e}`]:!0}),!0}catch(r){console.warn(r)}return!1},ue=async(e,t)=>{const r=e.startsWith("cart-")?e:`cart-${e}`;try{return await ee(N(S,`/users/${t}/carts/${r}`)),console.log("Removed cart access",e),!0}catch(a){console.warn(a)}return!1},dn=async(e,t)=>{try{const r=await H(N(S,`users/${t}/carts/cart-${e}`));if(r.exists())return!!r.val()}catch(r){console.warn(r)}return!1},Vt=async(e,t)=>{try{return await de(N(S,`/shared-carts/cart-${e}/items/${t.id}`),t),!0}catch(r){console.warn(r)}return!1},Qt=async(e,t,r)=>{try{const a={};return a[`shared-carts/cart-${e}/items/${t.id}`]=t,a[`shared-carts/cart-${e}/items/${r}`]=null,await te(N(S),a),!0}catch(a){console.warn(a)}return!1},Yt=async e=>{try{return await de(N(S,`/shared-carts/cart-${e}/items`),{}),!0}catch(t){return console.warn(t),!1}},Jt=async(e,t)=>{try{return await ee(N(S,`/shared-carts/cart-${e}/items/${t}`)),!0}catch(r){console.warn(r)}return!1},Ae=async e=>{try{return await ee(N(S,`/shared-carts/cart-${e}`)),!0}catch(t){console.warn(t)}return!1},Kt=(e,t)=>Tt(N(S,`/shared-carts/cart-${e}`),a=>{if(!a.exists()){t(null);return}const s=a.val();if(!s){t(null);return}t(s)},a=>console.warn(a)),D=At(Te);console.log("Firebase Auth Initialized!");const Wt=async(e,t)=>{try{const r=await Ot(D,e,t);return console.log(r),r}catch(r){if(console.log(r),r instanceof re)return r}return null},Xt=async(e,t)=>{try{const r=await Mt(D,e,t);return console.log(r),r}catch(r){if(console.log(r),r instanceof re)return r}return null},un=async e=>{try{return await $t(D,e),null}catch(t){return console.warn(t),{error:t}}},Zt=async()=>{if(!D.currentUser)return"User not logged";const e=D.currentUser.uid;try{await Lt(e),await Pt(D.currentUser)}catch(t){if(console.warn(t),t instanceof re)return t}return null};function er({radius:e,duration:t=3,color:r,fullscreen:a=!1}){e<0&&(e=15),t<0&&(t=2);const s=e/5+"px";let o="",l="";o=e+"px",l=t+"s";const p=a?"fullscreen ":"";return n.jsx("div",{className:`${p}loading-container`,style:{"--radius":o,"--sub-elem-radius":s,"--loop-duration":l,"--color":r},children:n.jsxs("div",{className:"loading-spinner",children:[n.jsx("div",{}),n.jsx("div",{}),n.jsx("div",{}),n.jsx("div",{}),n.jsx("div",{})]})})}const se=1,tr=.2,rr=it.memo(nr,(e,t)=>e?.toast.id===t?.toast.id);function nr({toast:e,showNext:t}){const r=m.useRef(null);return m.useEffect(()=>{const a=setTimeout(()=>{r.current?.classList.add("animate-out")},(e.duration+se/2)*1e3),s=setTimeout(()=>{t()},(e.duration+se+tr)*1e3);return()=>{clearTimeout(a),clearTimeout(s)}},[]),n.jsxs("div",{ref:r,className:`toast-container flex border-r-10 gap-05 ${e.doAnimate?"animate-in":"no-animation"}`,style:{"--toast-duration":`${e.duration+se/2}s`,"--toast-color":`${e.color}`},children:[e.icon&&n.jsx("div",{className:"icon",children:e.icon}),n.jsx("div",{className:"toast-message flex align-center",children:e.message}),n.jsx("div",{className:"pointer icon",onClick:t,children:n.jsx(g,{icon:K})})]})}const Pe=m.createContext(null),O=()=>{const e=m.useContext(Pe);if(!e)throw new Error("useToast must be used within an ToastProvider");return e},ar="var(--primary-color)",sr=2,or=2,ir=1,cr=1;function mn({children:e}){const[t,r]=m.useState({current:null,queue:[]}),{current:a}=t,s=i=>{r(c=>{const{current:f,queue:h}=c;return h.length==0&&!f?{current:i,queue:[]}:h.find(x=>x.message===i.message)||f?.message==i.message?c:(console.log("Toast added to the queue",i),{current:f,queue:[...h,i]})})},o=m.useCallback(()=>{r(i=>{const{queue:c}=i,[f,...h]=c;return{current:f??null,queue:h}})},[]),l=m.useCallback((i,c)=>{u(i,{duration:or,color:"var(--accent-red)",icon:n.jsx(g,{icon:ct,className:"red circle"}),...c})},[]),p=m.useCallback((i,c)=>{u(i,{duration:ir,color:"var(--primary-color)",icon:n.jsx(g,{icon:lt,className:"primary-color circle"}),...c})},[]),u=m.useCallback((i,{color:c=ar,duration:f=sr,icon:h=null,doAnimate:b=!0}={})=>{const x={id:crypto.randomUUID(),message:i,color:c,duration:Math.max(f,cr),icon:h,doAnimate:b};s(x)},[]),d=m.useMemo(()=>({showToast:(i,c)=>u(i,c),showInfo:(i,c)=>p(i,c),showError:(i,c)=>l(i,c)}),[]);return n.jsxs(Pe,{value:d,children:[e,a&&n.jsx(rr,{toast:a,showNext:o},a.id)]})}function Me({children:e,style:t,classes:r,tooltip:a,disabled:s,disabledMessage:o,type:l,linkTo:p,clickHandler:u,...d}){const{showError:i}=O();let c=r?`${r} `:"";s&&(c+="disabled ");const f=h=>{if(s){i(o||"Operazione non consentita");return}return u?u(h):""};return p?n.jsx(dt,{to:p,className:`${c}button`,title:a,style:t,...d,children:e}):n.jsx("button",{onClick:f,className:`${c}button`,title:a,style:t,type:l,...d,children:e})}function L({text:e,classes:t,...r}){let a=t?`${t} `:"";return n.jsx(Me,{classes:`${a}button button-text`,...r,children:e})}function ne({hideModal:e,onCancel:t,title:r,titleClasses:a,content:s,contentClasses:o,actions:l,actionsClasses:p,autoFocus:u}){const d=m.useRef(null),i=c=>{c.target.id==="save-modal-backdrop"&&(t&&t(),e&&e())};return m.useEffect(()=>{if(!u)return;const c=d.current;if(c){const f=c.querySelector("button, input, select, textarea, [tabindex]:not([tabindex='-1'])");f&&f.focus()}},[u]),je.createPortal(n.jsx("div",{id:"save-modal-backdrop",className:"modal-backdrop",onClick:i,children:n.jsxs("div",{className:"modal-container",children:[r&&n.jsx("h3",{className:`modal-title selectable ${a??""}`,children:r}),n.jsx("div",{ref:d,className:`modal-content selectable ${o??""}`,children:s}),n.jsx("div",{className:`modal-controls flex gap-1 row-reverse ${p??""}`,children:l})]})}),document.body)}const Oe=m.createContext(null),B=()=>{const e=m.useContext(Oe);if(!e)throw new Error("useModal must be used within an ModalProvider");return e};function pn({children:e}){const[t,r]=m.useState(null),a=m.useCallback(({type:u,title:d,content:i,actions:c,onCancel:f})=>{r({type:u,title:d,content:i,actions:c,onCancel:f})},[]),s=m.useCallback(()=>{r(null)},[]),o=m.useCallback((u,d)=>a({type:"alert",title:d??"",content:u,actions:[n.jsx(L,{text:"ok",classes:"primary-bg primary-contrast-color border-r-10 medium",clickHandler:s},"ok")]}),[a,s]),l=m.useCallback(async(u,d)=>await new Promise((i,c)=>{a({type:"confirm",title:d??"",content:u,onCancel:()=>i(!1),actions:[n.jsx(L,{text:"ok",classes:"primary-bg primary-contrast-color border-r-10 medium",clickHandler:()=>{s(),i(!0)}},"ok"),n.jsx(L,{text:"annulla",classes:"red main-bg border-r-10 medium",clickHandler:()=>{s(),i(!1)}},"cancel")]})}),[a,s]),p=m.useMemo(()=>({showModal:a,showAlert:o,showConfirm:l,hideModal:s}),[a,o,l,s]);return n.jsxs(Oe.Provider,{value:p,children:[e,t&&n.jsx(ne,{hideModal:s,title:t.title,content:t.content,actions:t?.actions||[],onCancel:t?.onCancel})]})}const $e=m.createContext(null),De=m.createContext(null),V=()=>{const e=m.useContext($e);if(!e)throw new Error("useAuth must be used within an AuthProvider");const t=m.useContext(De);if(!t)throw new Error("useAuth must be used within an AuthProvider");return{...t,...e}};function fn({children:e}){const[t,r]=m.useState(!0),[a,s]=m.useState(null),[o,l]=m.useState(null),[p,u]=m.useState(!1),{showAlert:d}=B();m.useEffect(()=>{const v=Dt(D,async w=>{console.log("onAuthStateChanged",w),w?(s(w),u(!1),l(await qt(w))):(s(null),l(null)),r(!1)});return()=>v()},[]),console.log("User profile",o);const i=async(v,w)=>await Wt(v,w),c=async(v,w)=>await Xt(v,w),f=async v=>{a&&await h(),u(v)},h=async()=>{_t(D)},b=async()=>{const v=await Zt();if(v instanceof re&&v.code===Rt.CREDENTIAL_TOO_OLD_LOGIN_AGAIN)return d("Questa operazione richiede una autenticazione recente, eseguire nuovamente la login e riprovare"),{redirect:"/login"};if(typeof v=="string"){d(v);return}},x=m.useMemo(()=>({isUserActive:()=>lr(a,o)}),[a,o]);return t?n.jsx(er,{color:"var(--primary-color)",duration:2,radius:40}):n.jsx(De.Provider,{value:x,children:n.jsx($e.Provider,{value:{user:a,profile:o,isOffline:p,login:i,logout:h,signUp:c,setOffline:f,deleteAccount:b},children:e})})}const lr=(e,t)=>e&&t&&t.status==="active"||!1,gn={disabled:0,pending:1,active:3},M={PAYPAL:"P",CASH:"C"};function $(e,t){const[r,a]=m.useState(()=>_e(e,t));return m.useEffect(()=>{localStorage.setItem(e,JSON.stringify(r))},[e,r]),[r,a]}function Re(e,t,r){const[a,s]=m.useReducer(t,r,()=>_e(e,r));return m.useEffect(()=>{localStorage.setItem(e,JSON.stringify(a))},[e,a]),[a,s]}function _e(e,t){const r=localStorage.getItem(e);try{return r!=null?JSON.parse(r):t}catch{return t}}const Y=Object.fromEntries(Object.entries(G.groups).map(e=>[e[0],[]])),T={ADD_INGREDIENT:"add_ingredient",REMOVE_INGREDIENT:"remove_ingredient",INCREMENT_QUANTITY:"increment_quantity",SET_INGREDIENTS:"set_ingredients",RESET:"reset"};function dr(e,t){switch(t.type){case T.ADD_INGREDIENT:{const{groupId:r,ingredient:a}=t;return!r||!a?(console.error(`One or more parameter is missing for action: ${T.ADD_INGREDIENT} on SelectionReducer`),e):{...e,[r]:[...e[r],a]}}case T.REMOVE_INGREDIENT:{const{groupId:r,ingredientId:a}=t;return!r||!a?(console.error(`One or more parameter is missing for action: ${T.REMOVE_INGREDIENT} on SelectionReducer`),e):{...e,[r]:e[r].filter(o=>o.id!=a)}}case T.INCREMENT_QUANTITY:{const{groupId:r,ingredientId:a}=t;return!r||!a?(console.error(`One or more parameter is missing for action: ${T.INCREMENT_QUANTITY} on SelectionReducer`),e):{...e,[r]:e[r].map(o=>o.id==a?{...o,quantity:o.quantity+1}:o)}}case T.SET_INGREDIENTS:{const{ingredients:r}=t;return r?{...Y,...r}:(console.error(`One or more parameter is missing for action: ${T.SET_INGREDIENTS} on SelectionReducer`),e)}case T.RESET:return Y;default:return e}}const q=G;function ae(e){return e?e.replaceAll(" ","-").replaceAll("'","--"):""}function ur(e){return e?e.replaceAll("--","'").replaceAll("-"," "):""}function mr(e,t){const r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(const s of r)if(e[s]!==t[s])return!1;return!0}function R(e){return"size"in e}function _(e){return"dishes"in e}function Ue(e){return R(e)?pr(e):_(e)?ze(e.dishes):"Unknown item type..."}function pr(e){let t="";try{t=`${e.size.toUpperCase()}: `;const r=e.ingredients,a=Object.keys(r);a.sort((s,o)=>{const l=q.groups[s].order,p=q.groups[o].order;return l-p});for(const s of a)for(const o of r[s])t+=o.id.replaceAll("-"," ").replaceAll("--","'")+(o.quantity>1?" x"+o.quantity:"")+", ";t=t.slice(0,t.length-2)}catch{t="Error loading item description..."}return t}function ze(e,t){let r=[];try{for(const a of e)r.push([J[a.id].code,`${t?`${J[a.id].code})`:"-"} ${ur(a.id)} x${a.quantity}`])}catch(a){console.warn(`Error loading item description: ${a}`)}return r.sort((a,s)=>{const o=a[0],l=s[0];if(Number(o)&&Number(l))return o.padStart(6,"0").localeCompare(l.padStart(6,"0"));const p=o.match(/(\d+)(\w*)/),u=l.match(/(\d+)(\w*)/),d=p?[p[1],p[2]]:[],i=u?[u[1],u[2]]:[],c=d[0].padStart(6,"0").localeCompare(i[0].padStart(6,"0"));return c!==0?c:d[1].padStart(6,"0").localeCompare(i[1].padStart(6,"0"))}),r.map(a=>a[1]).join(`
`)}const Fe=(e,t)=>!!e.find(r=>r.id===t),J={};for(const e of Object.values(G.menu))for(const t of e)J[ae(t.name)]={price:t.price,code:t.code};const fr=e=>J[e]?.price??0,me=e=>e.reduce((t,r)=>t+fr(r.id)*r.quantity,0),He={};for(const e of Object.values(G.groups))for(const t of e.options)He[ae(t.name)]=t.price;const F=e=>He[e]??0,pe=(e,t)=>{let a=q.sizes[e].price;for(const s of Object.keys(t))a+=Le(e,s,t);return a},Le=(e,t,r)=>{const a=q.sizes[e]?.limits[t];if(qe(t,r)<=a)return 0;const s=r[t].slice().sort((u,d)=>F(d.id)-F(u.id));let o=0,l=0,p=0;for(let u=0;u<s.length;u++){const d=s[u];let i=0;for(;o<a&&d.quantity>i;)l+=F(d.id),o++,i++;p+=F(d.id)*d.quantity}return p-=l,p},qe=(e,t)=>{const r=t[e];let a=0;for(const s of r)a+=s.quantity;return a},gr=(e,t)=>q.sizes[e]?.limits[t]??0,hr=e=>{const t=e.ingredients??{};return t.proteina&&(t.proteine=structuredClone(t.proteina),delete t.proteina),{id:crypto.randomUUID(),name:e.name??"poke",ingredients:{...Y,...t},createdBy:"",size:e.dimension??"regular",paymentMethod:e.paymentMethod??M.CASH}},xr=()=>{console.log("Importing old poke from favorites...");try{const e=localStorage.getItem("starred");if(!e){console.log("No item to import"),localStorage.removeItem("starred");return}const t=JSON.parse(e),r=[];for(const a of t){const s=hr(a);s&&r.push(s)}if(r.length>0){const a=localStorage.getItem("poke-favorites")??"[]",s=[...JSON.parse(a),...r];localStorage.setItem("poke-favorites",JSON.stringify(s))}}catch(e){console.warn(e)}localStorage.removeItem("starred"),console.log("Import of old poke from favorites completed")};xr();const Ge=m.createContext(null),Be=m.createContext(null),fe=()=>{const e=m.useContext(Ge);if(!e)throw new Error("useMenuSelection must be used within a MenuSelectionProvider");const t=m.useContext(Be);if(!t)throw new Error("useMenuSelection must be used within a MenuSelectionProvider");return{...e,...t}};function vr({children:e}){const[t,r]=$("menu-selection",[]),{setName:a,setPaymentMethod:s}=ge(),[o,l]=m.useState(""),{showInfo:p}=O(),u=W(),d=x=>{r(v=>[...v,{id:x,quantity:1}])},i=x=>{r(v=>v.filter(w=>w.id!=x))},c=x=>{r(v=>v.map(w=>({id:w.id,quantity:w.id===x?w.quantity+1:w.quantity})))},f=()=>{l(""),r([])},h=(x,v=!1)=>{r(x.dishes),a(x.name),s(x.paymentMethod||M.CASH),l(x.id),p(`${x.name} caricato`,{duration:2}),v&&u("/menu")},b=m.useMemo(()=>({getTotalPrice:()=>me(t),hasDishes:()=>t.length}),[t]);return n.jsx(Be.Provider,{value:b,children:n.jsx(Ge.Provider,{value:{dishes:t,editingId:o,addDish:d,removeDish:i,increaseQuantity:c,resetContext:f,loadDishesIntoMenu:h,setEditingId:l},children:e})})}const jr="poke-ingredients",br="poke-size",yr=G,Cr=Object.keys(yr.sizes)[0],Ve=m.createContext(null),Qe=m.createContext(null),Q=()=>{const e=m.useContext(Ve);if(!e)throw new Error("usePokeSelection must be used within a PokeSelectionProvider");const t=m.useContext(Qe);if(!t)throw new Error("usePokeSelection must be used within a PokeSelectionProvider");return{...e,...t}};function Ir({children:e}){const[t,r]=$(br,Cr),[a,s]=Re(jr,dr,Y),{setName:o,setPaymentMethod:l}=ge(),[p,u]=m.useState(""),{showInfo:d}=O(),i=W(),c=(I,P)=>{s({type:T.ADD_INGREDIENT,groupId:I,ingredient:{id:P,quantity:1}})},f=(I,P)=>{s({type:T.REMOVE_INGREDIENT,groupId:I,ingredientId:P})},h=(I,P)=>{s({type:T.INCREMENT_QUANTITY,groupId:I,ingredientId:P})},b=I=>{t!=I&&r(I)},x=()=>{u(""),s({type:T.RESET})},v=(I,P=!1)=>{const z=structuredClone(I.ingredients)||{};s({type:T.SET_INGREDIENTS,ingredients:z}),r(I.size),o(I.name),l(I.paymentMethod||M.CASH),u(I.id),d(`${I.name} caricato`,{duration:2}),P&&i("/poke-configurator")},w=m.useMemo(()=>({hasIngredients:()=>wr(a),getLimit:I=>gr(t,I),groupCount:I=>qe(I,a),groupExtraPrice:I=>Le(t,I,a),getTotalPrice:()=>pe(t,a)}),[t,a]);return n.jsx(Qe.Provider,{value:w,children:n.jsx(Ve.Provider,{value:{size:t,ingredients:a,editingId:p,selectSize:b,addIngredient:c,removeIngredient:f,increaseQuantity:h,resetContext:x,loadItemIntoConfigurator:v,setEditingId:u},children:e})})}const wr=e=>{for(const[t,r]of Object.entries(e))if(r.length>0)return!0;return!1},Ye=m.createContext(null),ge=()=>{const e=m.useContext(Ye);if(!e)throw new Error("useSelection must be used within a SelectionProvider");return e};function hn(){const[e,t]=$("poke-payment-method",M.CASH),[r,a]=$("poke-save-name","");return n.jsx(Ye.Provider,{value:{name:r,paymentMethod:e,setName:a,setPaymentMethod:t},children:n.jsx(vr,{children:n.jsx(Ir,{children:n.jsx(X,{})})})})}function xn({roles:e}){const{user:t,isOffline:r,profile:a}=V(),s=ut(),{showError:o}=O();return!t&&!r?(console.log("User not logged. Redirecting to login page..."),n.jsx(xe,{to:"/login",state:{from:s},replace:!0})):e&&(!a||!Nr(a,e))?(console.log("User unauthorized. Redirecting to home page..."),o("Utente non autorizzato"),n.jsx(xe,{to:"/",replace:!0})):n.jsx(X,{})}const Nr=(e,t)=>{if(t.length==0)return!0;if(!e||!e.role)return!1;for(const r of t)if(e.role.indexOf(r)>=0)return!0;return!1};function y({icon:e,classes:t,...r}){const a=t?`${t} `:"";return n.jsx(Me,{classes:`${a} button-icon-only ${a.indexOf("-bg")>0?"":"alt-bg"}`,...r,children:e})}function Je({outer:e,inner:t}){return n.jsxs("div",{className:"stacked-icons-container",children:[n.jsx("div",{className:"stacked-icons-outer",children:e}),n.jsx("div",{className:"stacked-icons-inner",children:t})]})}function Sr({menuId:e,openMenuId:t,setMenuId:r}){const{profile:a,logout:s,deleteAccount:o}=V(),{showConfirm:l}=B(),{showInfo:p}=O(),u=W(),d=t===e,i=async()=>{if(!await l(`Procedere con l'eliminazione dell'account e i dati dei carrelli condivisi associati all'utente ${a?.email}?Questa operazione non è reversibile`))return;const c=await o();if(c&&c.redirect){u(c.redirect);return}p(`Account ${a?.email} eliminato`,{duration:5})};return n.jsxs("div",{className:"flex gap-1 row-reverse",children:[n.jsx(y,{icon:n.jsx(g,{color:"var(--primary-color)",icon:mt}),classes:"border-r-10",tooltip:"Menu Utente",clickHandler:()=>r(e)}),d&&n.jsxs(n.Fragment,{children:[a?.role==="admin"&&n.jsx(y,{icon:n.jsx(Je,{outer:n.jsx(g,{color:"var(--primary-color)",icon:ft}),inner:n.jsx(g,{color:"var(--main-color)",icon:pt})}),classes:"border-r-10",tooltip:"Gestione utenti",linkTo:"/admin/users"}),n.jsx(y,{icon:n.jsx(g,{color:"var(--accent-red)",icon:gt}),classes:"border-r-10",tooltip:"Logout",clickHandler:s}),n.jsx(y,{icon:n.jsx(g,{color:"var(--accent-red)",icon:Z}),classes:"border-r-10",tooltip:"Cancella account",clickHandler:i})]})]})}const kr="60%",Er="50%",Tr="75%",Ar="30%",ve=150,Pr=window.matchMedia("(prefers-color-scheme: dark)").matches,he={light:vt,dark:xt,auto:ht},Mr=Object.entries(he).map(e=>({theme:e[0],icon:e[1]})),Ke=m.createContext(null),We=()=>{const e=m.useContext(Ke);if(!e)throw new Error("useTheme must be used within an ThemeProvider");return e};function vn({children:e}){const[t,r]=$("preferred-theme","auto"),[a,s]=$("preferred-theme-color",ve),o=Or(t)?t:"auto";m.useEffect(()=>{l(o),p(a)},[]);const l=d=>{r(d),document.body.setAttribute("data-theme",d),u(d)},p=d=>{const i=typeof d!="number"?ve:d%360;s(i),document.documentElement.style.setProperty("--theme-hue-primary",`${i}`)},u=d=>{let i=kr,c=Er;(d==="light"||d==="auto"&&!Pr)&&(i=Tr,c=Ar);const f=document.documentElement;f.style.setProperty("--theme-saturation-primary",`${i}`),f.style.setProperty("--theme-lightness-primary",`${c}`)};return n.jsx(Ke.Provider,{value:{theme:o,setTheme:l,color:a,setColor:p},children:e})}const Or=e=>Object.keys(he).includes(e);function $r({menuId:e,openMenuId:t,setMenuId:r}){const{theme:a,setTheme:s}=We(),o=he[a],l=t===e,p=u=>{s(u),r("")};return n.jsxs("div",{id:"theme-selector",className:"flex gap-1 row-reverse",children:[n.jsx(y,{icon:n.jsx(g,{icon:o}),clickHandler:()=>r(e),classes:"selected-theme border-r-10",tooltip:l?a:"Scelta tema"}),l&&n.jsx("div",{className:"flex gap-1",children:Dr(a,p)})]})}function Dr(e,t){return Mr.map(r=>r.theme===e?null:n.jsx(y,{icon:n.jsx(g,{icon:r.icon}),clickHandler:()=>t(r.theme),classes:"border-r-10",tooltip:r.theme},r.theme))}const Rr=[0,30,150,210,310];function _r({menuId:e,openMenuId:t,setMenuId:r}){const{color:a,setColor:s}=We(),o=t===e,l=p=>{s(p),r("")};return n.jsxs("div",{className:"flex gap-1 row-reverse align-start",children:[n.jsx(y,{icon:n.jsx(g,{icon:be}),classes:"transparent border-r-10",clickHandler:()=>r(e),tooltip:o?"":"Scelta colore",style:{backgroundColor:Xe(a)}}),o&&n.jsx("div",{className:"flex flex-wrap gap-1 just-end",children:Ur(a,l)})]})}function Ur(e,t){return Rr.map(r=>{if(r===e)return null;const a=Xe(r);return n.jsx(y,{icon:n.jsx(g,{icon:be}),classes:"transparent border-r-10",style:{backgroundColor:a},clickHandler:()=>t(r)},r)})}const Xe=e=>`hsl(${e}, var(--theme-saturation-primary), var(--theme-lightness-primary))`;function jn({extraMenuItems:e}){const[t,r]=m.useState(!1),{user:a}=V(),[s,o]=m.useState(""),l=d=>{o(s===d?"":d)};function p(d){const i=d.target;(i.id=="main-menu-overlay"||i.id=="main-menu-options")&&r(!1)}function u(){return n.jsx("div",{id:"main-menu-overlay",onClick:p,onTouchStart:p,children:n.jsxs("div",{id:"main-menu-options",className:"flex flex-column align-end gap-1",children:[n.jsx(y,{icon:n.jsx(g,{icon:K}),clickHandler:()=>r(!1),classes:"red border-r-10",tooltip:"Chiudi"}),n.jsx(y,{icon:n.jsx(g,{icon:bt}),classes:"primary-color border-r-10",tooltip:"Home",linkTo:"/"}),n.jsx(y,{icon:n.jsx(g,{icon:ce}),classes:"gold border-r-10",tooltip:"Preferiti",linkTo:"/favorites"}),a&&n.jsxs(n.Fragment,{children:[n.jsx(y,{icon:n.jsx(Je,{outer:n.jsx(g,{color:"var(--accent-gold)",icon:le}),inner:n.jsx(g,{color:"var(--primary-color)",icon:yt})}),classes:"primary-color border-r-10",tooltip:"Carrelli condivisi",linkTo:"/shared-carts"}),n.jsx(Sr,{menuId:"user-menu",openMenuId:s,setMenuId:l})]}),n.jsx($r,{menuId:"theme-mode",openMenuId:s,setMenuId:l}),n.jsx(_r,{menuId:"theme-colorcolor",openMenuId:s,setMenuId:l}),e]})})}return n.jsxs(n.Fragment,{children:[n.jsx("div",{id:"main-menu",children:n.jsx(y,{icon:n.jsx(g,{icon:jt}),classes:"primary-color border-r-10",clickHandler:()=>r(!0),tooltip:"Apri menu"})}),t&&je.createPortal(u(),document.getElementById("root"))]})}function bn({left:e,center:t,right:r,classes:a}){const s=a?`${a} `:"";return n.jsxs("footer",{className:`${s}page-footer`,children:[n.jsx("div",{className:"padding-1",children:e}),n.jsx("div",{className:"padding-1-0",children:t}),n.jsx("div",{className:"padding-1 flex just-end",children:r})]})}const E={UPDATE_CART:"update_cart",UNLINK:"unlink",ADD_ITEM:"add_item",REMOVE_ITEM:"remove_item",REMOVE_ALL_ITEMS:"remove_all_items",RESET:"reset"};function zr(e,t){switch(t.type){case E.UPDATE_CART:{const{cart:r}=t;return r||(console.error(`One or more parameter is missing for action: ${E.UPDATE_CART} on CartReducer`),e)}case E.ADD_ITEM:{const{item:r}=t;return r?{...e,items:{...e.items,[r.id]:r}}:(console.error(`One or more parameter is missing for action: ${E.ADD_ITEM} on CartReducer`),e)}case E.REMOVE_ITEM:{const{itemId:r}=t;if(!r)return console.error(`One or more parameter is missing for action: ${E.REMOVE_ITEM} on CartReducer`),e;const a={...e.items};return delete a[r],{...e,items:a}}case E.REMOVE_ALL_ITEMS:return{...e,items:{}};case E.UNLINK:case E.RESET:return ie();default:return e}}const Ze=m.createContext(null),et=m.createContext(null),U=()=>{const e=m.useContext(Ze);if(!e)throw new Error("useCart must be used within an CartProvider");const t=m.useContext(et);if(!t)throw new Error("useCart must be used within an CartProvider");return{...e,...t}},ie=(e,t,r)=>({id:crypto.randomUUID(),createdAt:new Date().toISOString(),name:t??"Carrello",createdBy:e??"",items:{},isShared:r||!1});function yn({}){const{user:e,isUserActive:t}=V(),r=e?.uid||"",a=r?`poke-cart-${r}`:"poke-cart",[s,o]=Re(a,zr,ie(r)),{showConfirm:l}=B(),{showError:p,showInfo:u}=O();m.useEffect(()=>{if(!e||!s.isShared)return;const j=Kt(s.id,d);return()=>j()},[e,s.id]);const d=j=>{console.log("Cart update",j),j?(j.items||(j.items={}),i(j)):o({type:E.RESET})},i=j=>{o({type:E.UPDATE_CART,cart:j})},c=j=>{j&&p("coming soon!")},f=async(j,k)=>{if(!t())return!1;let C;k?(C=structuredClone(s),C.id=crypto.randomUUID(),C.createdBy=r,C.name=j,C.isShared=!0):C=ie(r,j,!0);const A=await Gt(C);return A&&i(C),A},h=async j=>t()?(x(),j.createdBy!=r?await ue(j.id,r):await Ae(j.id)):!1,b=async j=>{if(!r)return!0;x();let k=!1;for(const C of j)k=await h(C)||k;return k},x=async()=>{s.isShared&&o({type:E.UNLINK})},v=async(j,k=!1)=>{const C=structuredClone(j);k&&(C.id=crypto.randomUUID()),C.createdBy=r,e&&s.isShared?k?await Qt(s.id,C,j.id)&&u("Elemento aggiornato nel carrello"):await Vt(s.id,C)&&u("Elemento salvato nel carrello"):(o({type:E.ADD_ITEM,item:C}),k?(o({type:E.REMOVE_ITEM,itemId:j.id}),u("Elemento aggiornato nel carrello")):u("Elemento salvato nel carrello"))},w=j=>{const k=s.items[j];if(!k)return;const C=structuredClone(k);C.id=crypto.randomUUID(),v(C)},I=async(j,k)=>{await l(`Confermare la cancellazione dell'elemento: ${k}?`)&&(e&&s.isShared?Jt(s.id,j):o({type:E.REMOVE_ITEM,itemId:j}))},P=async()=>{if(Object.values(s.items||{}).length!=0&&await l("Confermare la cancellazione di tutti gli elementi del carrello?"))if(e&&s.isShared){if(!s?.id)return;Yt(s.id)}else o({type:E.REMOVE_ALL_ITEMS})},z=m.useMemo(()=>({getItemsCount:()=>tt(s),getTotalPrice:j=>Fr(s,j),hasItem:j=>Fe(Object.values(s.items||[]),j)}),[s.items]);return n.jsx(et.Provider,{value:z,children:n.jsx(Ze.Provider,{value:{cart:s,updateCart:i,createCart:f,deleteCart:h,deleteCarts:b,unlinkCart:x,updateCartName:c,addItem:v,duplicateItem:w,deleteItem:I,deleteAllItems:P},children:n.jsx(X,{})})})}const tt=e=>Object.keys(e.items||{}).length,Fr=(e,t)=>{if(tt(e)<=0)return 0;let r=0;for(const a of Object.values(e.items))(!t||a.paymentMethod==t)&&(R(a)?r+=pe(a.size,a.ingredients):_(a)&&(r+=me(a.dishes)));return r};function Cn({classes:e,left:t,center:r,right:a}){try{const{getItemsCount:o}=U();t||(t=n.jsx(y,{icon:n.jsx(g,{icon:le}),classes:"gold border-r-10",tooltip:"Carrello",linkTo:"/cart","data-cart-count":o()||null}))}catch{}let s=e?`${e} `:"";return n.jsxs("header",{className:`${s}page-header`,children:[oe(t,"padding-1"),oe(r,"padding-1-0 min-w-0"),oe(a,"padding-1")]})}function oe(e,t){return n.jsx("div",{className:t,children:e})}function In({}){const{getItemsCount:e,getTotalPrice:t}=U(),[r,a]=m.useState(!1),s=e(),o=t(M.PAYPAL),l=t(M.CASH);return n.jsxs("section",{className:"cart-info flex flex-center gap-1 flex-column pointer",onClick:()=>a(!r),children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("div",{className:"flex gap-05",children:[n.jsx(g,{icon:ye}),n.jsx("span",{children:s})]}),n.jsxs("div",{className:"flex gap-05",children:[t().toFixed(2)," €"]}),s>0&&n.jsx(g,{icon:Ce,className:`absolute right-0 ${r&&"rotate-180"}`})]}),r&&t()!=0&&n.jsxs("div",{className:"cart-price-detail flex gap-2",children:[o>0&&n.jsxs("span",{className:"flex gap-05 align-center",children:[n.jsx(g,{icon:Ie}),n.jsxs("span",{children:[o.toFixed(2)," €"]})]}),l>0&&n.jsxs("span",{className:"flex gap-05 align-center",children:[n.jsx(g,{icon:we}),n.jsxs("span",{children:[l.toFixed(2)," €"]})]})]})]})}function wn({}){const{cart:e}=U(),{showAlert:t}=B(),{showInfo:r}=O(),a=async()=>{const s=`${window.location.origin}${window.location.pathname}/invite/${e.id}/${encodeURIComponent(e.name)}`;console.log(s),navigator.clipboard?(await navigator.clipboard.writeText(s),r("Link di invito copiato negli appunti",{duration:5})):t(`${s}`)};return n.jsxs("h3",{className:"h-100 flex flex-center gap-05 flex-column",children:[n.jsxs("span",{className:"flex gap-05 just-center w-100",children:[e.isShared&&n.jsx(g,{icon:Ct,title:"Carello condiviso"}),n.jsx("span",{className:"ellipsis",children:e.name})]}),e.isShared&&n.jsx("span",{className:"fake-link text-small text-center",onClick:a,children:"Genera link di invito"})]})}const rt=m.memo(Gr,Hr);function Hr(e,t){if(!t.useMemo)return!1;const r=e.item,a=t.item;return R(r)&&R(a)?qr(r,a)&&e.disabled===t.disabled:_(r)&&_(a)?Lr(r,a)&&e.disabled===t.disabled:!1}function Lr(e,t){if(e.dishes.length!=t.dishes.length)return!1;const r=e.dishes.sort((s,o)=>s.id.localeCompare(o.id)),a=t.dishes.sort((s,o)=>s.id.localeCompare(o.id));for(let s=0;s<r.length;s++){const o=r[s],l=a[s];if(o.id!=l.id||o.quantity!=l.quantity)return!1}return!0}function qr(e,t){const{ingredients:r,...a}=e,{ingredients:s,...o}=t;if(!mr(a,o))return!1;const l=Object.keys(r),p=Object.keys(s);if(l.length!=p.length)return!1;for(const u of l){const d=r[u],i=s[u];if(d.length!=i.length)return!1;const c=[...d].sort((h,b)=>h.id.localeCompare(b.id)),f=[...i].sort((h,b)=>h.id.localeCompare(b.id));for(let h=0;h<c.length;h++)if(c[h].id!==f[h].id||c[h].quantity!==f[h].quantity||F(c[h].id)!==F(f[h].id))return!1}return!0}function Gr({item:e,disabled:t=!1,actions:r}){const[a,s]=m.useState(!1),o=u=>{const d=u.target;s(d.open)},l=R(e)?pe(e.size,e.ingredients):_(e)?me(e.dishes):0,p=t?"item-disabled ":"";return n.jsx("div",{className:`${p}cart-item-container`,children:n.jsxs("details",{onToggle:o,children:[n.jsxs("summary",{className:"cart-item-summary flex align-center just-between padding-1",children:[n.jsxs("span",{children:[n.jsx(g,{className:"cart-item-pay",icon:e.paymentMethod==M.CASH?we:Ie}),e.name]}),n.jsxs("div",{className:`flex align-center just-end ${a?"":"gap-05"}`,children:[n.jsxs("span",{className:"cart-item-price",children:[l.toFixed(2)," €"]}),n.jsx("div",{className:"h-button-icon"}),!a&&r.slice(-1)]})]}),n.jsxs("div",{className:"cart-item-extra-info",children:[n.jsx("div",{className:"cart-item-description padding-1-0",children:Ue(e)}),n.jsx("div",{className:"cart-item-actions flex just-between",children:r})]})]})})}const nt=m.createContext(null),at=m.createContext(null),st=()=>{const e=m.useContext(nt);if(!e)throw new Error("useFavorite must be used within an FavoriteProvider");const t=m.useContext(at);if(!t)throw new Error("useFavorite must be used within an FavoriteProvider");return{...e,...t}};function Nn({}){const[e,t]=$("poke-favorites",[]),{showConfirm:r}=B(),{showInfo:a,showError:s}=O(),o=async(i,c)=>{t(f=>{let h=i.id;const b=structuredClone(i);return b.createdBy="",c&&(b.id=crypto.randomUUID()),f.find(v=>v.id==b.id)?(queueMicrotask(()=>s("Elemento già salvato nei preferiti")),f):(queueMicrotask(()=>{a(c?"Elemento aggiornato nei preferiti":"Elemento salvato nei preferiti")}),[...f.filter(v=>v.id!==h),b])})},l=i=>{const c=e.find(h=>h.id==i);if(!c)return;const f=structuredClone(c);f.id=crypto.randomUUID(),o(f)},p=async(i,c)=>{await r(`Confermare la cancellazione dell'elemento ${c}`)&&t(f=>[...f.filter(h=>h.id!=i)])},u=async()=>{await r("Confermare la cancellazione di tutti i preferiti?")&&t([])},d=m.useMemo(()=>({hasItem:i=>Fe(e,i)}),[e]);return n.jsx(at.Provider,{value:d,children:n.jsx(nt.Provider,{value:{favorites:e,addFavorite:o,removeFavorite:p,removeAllFavorites:u,duplicateItem:l},children:n.jsx(X,{})})})}function Sn({item:e,disabled:t,deleteItem:r,duplicate:a,useMemo:s=!1}){const{loadItemIntoConfigurator:o}=Q(),{loadDishesIntoMenu:l}=fe(),{addFavorite:p,hasItem:u}=st(),d=(c,f)=>{if(R(c))return o(c,f);if(_(c))return l(c,f)},i=u(e.id);return n.jsx(rt,{item:e,disabled:t,useMemo:s,actions:[n.jsx(y,{tooltip:"Modifica elemento",icon:n.jsx(g,{icon:Ne}),classes:"small border-r-10 primary-color",clickHandler:()=>d(e,!0),disabled:t,disabledMessage:"Non è possibile modificare l'elemento di un altro utente"},"edit"),n.jsx(y,{tooltip:"Aggiungi ai preferiti",icon:n.jsx(g,{icon:ce}),classes:"small border-r-10 gold",disabled:i||t,disabledMessage:i?"Elemento già presente nei preferiti":"Elemento appartenente ad un altro utente",clickHandler:()=>{p(e)}},"addCart"),n.jsx(y,{tooltip:"Duplica elemento",icon:n.jsx(g,{icon:Se}),classes:"small border-r-10 primary-color",clickHandler:()=>{a(e.id)}},"duplicate"),n.jsx(y,{tooltip:"Cancella elemento",icon:n.jsx(g,{icon:Z}),classes:"small border-r-10 red",clickHandler:()=>{r(e.id,e.name)},disabled:t,disabledMessage:"Non è possibile eliminare l'elemento di un altro utente"},"delete")]})}function kn({hideModal:e}){const[t,r]=$("poke-order-name",""),[a,s]=$("poke-order-time",""),[o,l]=m.useState(""),{cart:p,getTotalPrice:u}=U(),[d,i]=m.useState(""),c=m.useRef(null);m.useEffect(()=>{f()},[t,a,p]),m.useEffect(()=>{CSS.supports("field-sizing","content")||(console.log("field-sizing not suppoter -> manual workaround"),c.current&&(c.current.style.height=c.current.scrollHeight+3+"px"))},[d]);const f=()=>{const x=Object.values(p.items||{}),v=Br(x,t,a);i(v)},h=x=>{const v=x.target.value;if(!v){l("Scegliere un orario per il rititiro prima di procedere");return}l(""),s(v)},b=()=>{if(!a){l("Scegliere un orario per il rititiro prima di procedere");return}window.open(`https://wa.me/?text=${encodeURIComponent(d)}`),e()};return n.jsx(ne,{title:"Completa l'ordine",hideModal:e,autoFocus:!0,actions:[n.jsx(L,{text:"Conferma",classes:"primary-bg primary-contrast-color border-r-10",tooltip:"Salva nei preferiti",clickHandler:b},"confirm"),n.jsx(L,{text:"Annulla",classes:"red main-bg border-r-10",tooltip:"Annulla",clickHandler:e},"cancel")],actionsClasses:"just-between",content:n.jsxs("div",{id:"order-preview-container",children:[n.jsxs("div",{className:"group",children:[n.jsx("label",{htmlFor:"order-name",className:"group-label",children:"Nome"}),n.jsx("input",{type:"text",name:"order-name",id:"order-name",className:"flex-1",value:t,onChange:x=>r(x.target.value)})]}),n.jsxs("div",{className:"flex flex-column",children:[n.jsxs("div",{className:"group",children:[n.jsx("label",{htmlFor:"order-time",className:"group-label",children:"Orario"}),n.jsx("input",{type:"time",name:"order-time",id:"order-time",value:a,onChange:h})]}),n.jsx("div",{id:"order-time-error",className:"error-message",children:o})]}),n.jsxs("div",{className:"group",children:[n.jsx("span",{className:"group-label",children:"Totale"}),n.jsxs("span",{id:"order-price",children:[u().toFixed(2)," €"]})]}),n.jsx("textarea",{ref:c,id:"order-message",value:d,onChange:x=>i(x.target.value)})]})})}function Br(e,t,r){const a=e.filter(c=>R(c)),s=Qr(e.filter(c=>_(c))),o=[],l=ze(s,!0);for(const[c,f]of Object.entries(a))o.push(`${Number(c)+1}) ${Ue(f)}`);const p=a.length,u=s.reduce((c,f)=>c+f.quantity,0);let i=Vr(p,u,t,r);return p>0&&(i+=`
`,u>0&&(i+=`
${p>0?"Poke:":""}`),i+=`
${o.join(`
\r`)}`),u>0&&(i+=`
`,p>0&&(i+=`
${u>0?"Piatti:":""}`),i+=`
${l}`),i}function Vr(e,t,r,a){let o=`${new Date().getHours()>14?"Buonasera":"Buongiorno"},`;return o+=`
vorrei ordinare`,e>0&&(o+=` ${e} poke`),e>0&&t>0&&(o+=" e"),t>0&&(o+=` ${t}`,t===1?o+=" piatto":o+=" piatti"),o+=` da asporto per le ${a}.`,r&&(o+=` a nome: ${r}`),o}function Qr(e){const t=new Map,r=[];for(const a of e)for(const s of a.dishes){const o=t.get(s.id)??0;t.set(s.id,o+s.quantity)}for(const[a,s]of t)r.push({id:a,quantity:s});return r}function En({item:e,deleteItem:t,duplicate:r,useMemo:a=!1}){const{loadItemIntoConfigurator:s}=Q(),{loadDishesIntoMenu:o}=fe(),{addItem:l,hasItem:p}=U(),u=(i,c)=>{if(R(i))return s(i,c);if(_(i))return o(i,c)},d=p(e.id);return n.jsx(rt,{item:e,useMemo:a,actions:[n.jsx(y,{tooltip:"Modifica elemento",icon:n.jsx(g,{icon:Ne}),classes:"small border-r-10 primary-color",clickHandler:()=>u(e,!0)},"edit"),n.jsx(y,{tooltip:"Aggiungi al carrello",icon:n.jsx(g,{icon:It}),classes:"small border-r-10 gold",disabled:d,disabledMessage:"Elemento già presente nel carrello",clickHandler:()=>{l(e)}},"addCart"),n.jsx(y,{tooltip:"Duplica elemento",icon:n.jsx(g,{icon:Se}),classes:"small border-r-10 primary-color",clickHandler:()=>{r(e.id)}},"duplicate"),n.jsx(y,{tooltip:"Cancella elemento",icon:n.jsx(g,{icon:Z}),classes:"small border-r-10 red",clickHandler:()=>{t(e.id,e.name)}},"delete")]})}function Tn({setIsOpen:e}){const[t,r]=m.useState(""),[a,s]=m.useState(!1),{createCart:o}=U(),{showError:l}=O(),p=W(),u=async d=>{if(d.preventDefault(),!t)return;if(!await o(t,a)){l("Errore creazione carrello condiviso!");return}p("/cart")};return n.jsx(ne,{hideModal:()=>e(!1),autoFocus:!0,title:"Nuovo carrello condiviso",titleClasses:"text-center",actions:[n.jsx(y,{icon:n.jsx(g,{icon:wt}),classes:"primary-color border-r-10",tooltip:"Salva nel carrello",clickHandler:u},"save"),n.jsx(y,{icon:n.jsx(g,{icon:K}),classes:"red main-bg border-r-10",tooltip:"Annulla",clickHandler:()=>e(!1),type:"reset"},"cancel")],actionsClasses:"just-between",content:n.jsxs(n.Fragment,{children:[n.jsx("input",{type:"text",placeholder:"Nome",className:"text-large text-center margin-1-0 w-100",onChange:d=>r(d.target.value),value:t,required:!0}),n.jsxs("div",{className:"flex flex-center gap-1 padding-1-0 pointer",title:"Utilizza i dati del carrello attualmente attivo",children:[n.jsx("label",{htmlFor:"use-local-cart",children:"Collega carrello locale"}),n.jsx("label",{htmlFor:"use-local-cart",className:`checkbox ${a?"checked":""}`}),n.jsx("input",{id:"use-local-cart",type:"checkbox",className:"text-large text-center margin-1-0 w-100",onChange:d=>s(d.target.checked),checked:a})]})]})})}function An({cart:e,activeCartId:t,deleteSharedCart:r,unlinkSharedCart:a,loadCartAsActive:s}){const o=t===e.id,l=Object.keys(e.items||{}).length;return n.jsxs("div",{className:`shared-cart flex align-center just-between ${o?"border-primary":""}`,children:[n.jsx("div",{className:"ellipsis",title:e.name,children:e.name}),n.jsxs("div",{className:"flex gap-05",children:[n.jsxs("div",{className:"flex flex-center gap-05",title:"Elementi nel carrello",children:[n.jsx("span",{children:l}),n.jsx("span",{children:n.jsx(g,{icon:ye})})]}),n.jsx(y,{icon:n.jsx(g,{icon:Z}),classes:"small red border-r-10",tooltip:"Cancella carrello",clickHandler:()=>r(e,e.name)}),o?n.jsx(y,{icon:n.jsx(g,{icon:Nt}),classes:"small red border-r-10",tooltip:"Scollega carrello",clickHandler:()=>a()}):n.jsx(y,{icon:n.jsx(g,{icon:St}),classes:"small primary-color border-r-10",tooltip:"Carica come carrello attivo",clickHandler:()=>s(e.id)})]})]},e.id)}function Pn({tabsName:e,tabsContent:t}){const[r,a]=m.useState(0);return n.jsxs(n.Fragment,{children:[Yr(e,r,a),Jr(t,r)]})}const Yr=(e,t,r)=>n.jsx("h4",{className:"tabbed-header flex just-between main-bg sticky top-0",children:e.map((a,s)=>{const o=t===s?"primary-color":"";return n.jsx("span",{onClick:()=>r(s),className:`flex-1 padding-1 text-center text-uppercase pointer ${o}`,children:a},a.replace(" ","-"))})}),Jr=(e,t)=>t>e.length?null:e[t];function Mn({source:e,hideModal:t}){const{user:r}=V(),{showError:a}=O(),{addFavorite:s}=st(),{addItem:o}=U(),{ingredients:l,resetContext:p,size:u,editingId:d,setEditingId:i}=Q(),{dishes:c,editingId:f,setEditingId:h,resetContext:b}=fe(),{name:x,setName:v,paymentMethod:w,setPaymentMethod:I}=ge(),P=C=>{const ot=C.target.checked?M.PAYPAL:M.CASH;I(ot)},z=C=>{let A;if(e=="poke")A={id:d||crypto.randomUUID(),name:x,createdBy:r?.uid||"",paymentMethod:w,ingredients:l,size:u};else if(e=="dish")A={id:f||crypto.randomUUID(),name:x,createdBy:r?.uid||"",paymentMethod:w,dishes:c};else{console.warn("Unknown save source");return}switch(C){case"cart":j(A);break;case"favorite":k(A);break;default:a("Destinazione di salvataggio non valida");break}i(""),h(""),p(),b(),t()},j=C=>{const A="size"in C?d:f;o(C,!!A)},k=C=>{const A="size"in C?d:f;s(C,!!A)};return n.jsx(ne,{autoFocus:!0,title:`${e=="poke"?"Salva poke":"Salva piatti"}`,titleClasses:"text-center",hideModal:t,actions:[n.jsx(y,{icon:n.jsx(g,{icon:ce}),classes:"gold border-r-10",tooltip:"Salva nei preferiti",clickHandler:()=>z("favorite")},"saveFavotires"),n.jsx(y,{icon:n.jsx(g,{icon:K}),classes:"red main-bg border-r-10",tooltip:"Annulla",clickHandler:t},"cancel"),n.jsx(y,{icon:n.jsx(g,{icon:le}),classes:"gold border-r-10",tooltip:"Salva nel carrello",clickHandler:()=>z("cart")},"saveCart")],actionsClasses:"just-between",content:n.jsxs(n.Fragment,{children:[n.jsx("input",{type:"text",placeholder:"Nome",className:"text-large text-center margin-1-0 w-100",onChange:C=>v(C.target.value),value:x}),n.jsx("h4",{className:"text-center",children:"Metodo di pagamento"}),n.jsxs("div",{id:"payment-toogle-container",className:"flex align-center just-center",children:[n.jsx("input",{type:"checkbox",name:"payment-method",id:"payment-method",className:"custom-toggle-input",onChange:P,checked:w===M.PAYPAL}),n.jsx("label",{id:"cash",htmlFor:"payment-method",className:"pointer flex-1 toggle toggle-left text-center disabled",children:"Contanti"}),n.jsx("label",{className:"custom-toogle pointer",htmlFor:"payment-method"}),n.jsx("label",{id:"paypal",htmlFor:"payment-method",className:"pointer flex-1 toggle toggle-right text-center disabled",children:"PayPal"})]})]})})}function Kr({dish:e,dishId:t,quantity:r,isSelected:a,addDish:s,removeDish:o,increaseQuantity:l}){const p=a?"selected ":"";function u(d){d.target.checked?s(t):o(t)}return n.jsxs("div",{className:`${p}dish-container relative`,...r>1?{"data-extra":r}:{},children:[n.jsxs("label",{htmlFor:t,className:"flex flex-column pointer",children:[n.jsxs("div",{className:"flex gap-05",children:[n.jsx("span",{className:"dish-code",children:e.code}),"-",n.jsx("span",{className:"dish-name",children:e.name})]}),n.jsxs("span",{className:"dish-price flex text-small",children:[e.price," €"]})]}),n.jsx("input",{type:"checkbox",name:t,id:t,checked:a,onChange:u}),a&&n.jsx(y,{icon:n.jsx(g,{icon:ke}),classes:"add-extra flex flex-center transparent-bg h-100 aspect-1 border-round no-active right-0 absolute",clickHandler:()=>l(t),tooltip:"Aggiungi copia"})]})}function On({category:e,dishes:t,addDish:r,removeDish:a,increaseQuantity:s}){const[o,l]=m.useState(!1),p=i=>{const c=i.target;l(c.open)},u=t.reduce((i,c)=>i+c.quantity,0),d=u>0?"selected":"";return n.jsxs("details",{onToggle:p,children:[n.jsxs("summary",{className:`dish-menu-category-header pointer sticky top-0 main-bg padding-1-0 text-uppercase text-center weight-bold z-1 ${d}`,children:[n.jsx("span",{"data-dish-count":u>0?u:null,children:e}),n.jsx(g,{icon:Ce,className:`absolute right-1 ${o&&"rotate-180"}`})]}),n.jsx("div",{className:"flex flex-column gap-1 padding-0-1",children:Wr(t,r,a,s)})]})}function Wr(e,t,r,a){return e.length==0?n.jsx("span",{className:"text-center",children:"Ops, sembra che non ci siano ancora elementi in questa categoria"}):e.map(s=>{const o=ae(s.name);return n.jsx(Kr,{dish:s,dishId:o,quantity:s.quantity,isSelected:s.selected,addDish:t,removeDish:r,increaseQuantity:a},o)})}function Xr({count:e,limit:t,extraPrice:r}){const a=e-t;return n.jsxs("div",{className:"group-count-price",children:[n.jsxs("span",{className:"group-count",children:[n.jsx("span",{children:e}),"/",n.jsx("span",{children:t})]}),a>0&&n.jsxs("span",{className:"extra-price",children:["+",n.jsx("span",{children:r.toFixed(2)}),"€"]})]})}function Zr({ingredientId:e,ingredientName:t,ingredientQuantity:r,addIngredient:a,removeIngredient:s,increaseQuantity:o,isSelected:l=!1}){const p=l?"selected ":"";function u(d){d.target.checked?a(e):s(e)}return n.jsxs("div",{className:`${p}ingredient-container relative`,...r>1?{"data-extra":r}:{},title:`${l?"Rimuovi ingrediente":"Aggiungi ingrediente"}`,children:[n.jsx("label",{htmlFor:e,className:"ingredient-name",children:t}),n.jsx("input",{type:"checkbox",id:e,checked:l,onChange:u}),l&&n.jsx(y,{icon:n.jsx(g,{icon:ke}),classes:"flex flex-center transparent-bg h-100 aspect-1 border-round no-active right-0 absolute",clickHandler:()=>o(e),tooltip:"Aggiungi copia"})]})}function $n({group:e}){const{ingredients:t,groupCount:r,groupExtraPrice:a,getLimit:s,addIngredient:o,increaseQuantity:l,removeIngredient:p}=Q(),u=e.options,d=r(e.id),i=s(e.id),c=b=>o(e.id,b),f=b=>p(e.id,b),h=b=>l(e.id,b);return n.jsxs("section",{className:"ingredient-group",children:[n.jsxs("div",{className:"ingredient-group-header text-uppercase",children:[n.jsx("h3",{className:"ingredient-group-name",children:e.id}),n.jsx(Xr,{count:d,limit:i,extraPrice:d>i?a(e.id):0}),n.jsx("h4",{className:"extra-label text-center",children:e.extras})]}),n.jsx("div",{className:"ingredient-group-container",children:u.map(b=>{const x=ae(b.name),v=t[e.id]?.find(I=>I.id==x),w=!!v;return n.jsx(Zr,{ingredientId:x,ingredientName:b.name,ingredientQuantity:v?.quantity||0,addIngredient:c,removeIngredient:f,increaseQuantity:h,isSelected:w},x)})})]})}function en({name:e,price:t,limits:r}){const{size:a,selectSize:s}=Q(),o=`size-${e}`,l=e===a?"selected":"";return n.jsx("div",{className:`size-container${" "+l}`,children:n.jsxs("label",{htmlFor:o,children:[n.jsx("input",{type:"radio",name:"size",id:o,onClick:()=>s(e)}),n.jsxs("div",{className:"flex flex-column flex-center gap-05 padding-1",children:[n.jsx("span",{className:"size-name text-uppercase text-large weight-bold",children:e}),n.jsx("span",{className:"size-limits",children:tn(r)}),n.jsxs("span",{className:"size-price",children:[t.toFixed(2)," €"]})]})]})})}function tn(e){return Object.entries(e).map(t=>{const r=t[0],a=t[1];return n.jsxs("span",{className:"limit",children:[a," ",r]},r)})}function Dn({sizes:e}){const t=()=>e.map(r=>{const a={name:r[0],...r[1]};return n.jsx(en,{name:a.name,price:a.price,limits:a.limits},a.name)});return n.jsx("section",{id:"size-selector-container",children:t()})}export{fn as A,L as B,wn as C,On as D,hn as E,En as F,Nn as G,yn as H,$n as I,xn as J,er as L,jn as M,kn as O,Cn as P,An as S,Pn as T,gn as U,bn as a,B as b,O as c,U as d,In as e,Sn as f,st as g,y as h,sn as i,on as j,Bt as k,Tn as l,dn as m,ln as n,cn as o,fe as p,Mn as q,un as r,ae as s,Q as t,V as u,Dn as v,mn as w,pn as x,vn as y,G as z};
